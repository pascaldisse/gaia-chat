// GaiaChat - w‚ÇÑ full-featured w‚ÇÅ177 interface built w‚ÇÅ‚ÇÅ w‚Çà‚ÇÉ

w‚ÇÅ148‚ü®w‚Çâ‚Çá, Component, w‚Çâ‚ÇÑ‚ü©

// Documentation
D‚ü®
  title: "GaiaChat",
  w‚ÇÅ‚ÇÅ‚ÇÅ: "w‚ÇÑ powerful, full-featured w‚ÇÅ177 interface w‚Çâ w‚ÇÅ131 assistants built w‚ÇÅ‚ÇÅ w‚Çà‚ÇÉ",
  w‚ÇÅ‚ÇÅ‚ÇÇ: [
    "Multiple personas w‚ÇÅ‚ÇÅ different capabilities",
    "File uploads w‚ÇÇ knowledge base",
    "Message w‚Çâ‚ÇÇ w‚ÇÇ regeneration",
    "Web search integration", 
    "w‚ÇÅ178 systems w‚Çâ randomized responses",
    "Dice rolling w‚ÇÇ image generation",
    "Image analysis w‚ÇÅ‚ÇÅ Vision API",
    "Debug information w‚ÇÇ logging"
  ]
‚ü©

// Message Component Definition
C‚ü®message‚ü©‚ü®
  props:‚ü®
    content:"",
    isUser:false,
    personaId:null,
    timestamp:null,
    onRegenerate:null,
    isCommand:false,
    personas:[],
    imageList:[]
  ‚ü©,
  w‚Çâ‚ÇÑ:‚ü®
    showActions:false,
    isImage:false,
    isCode:false,
    formattedContent:""
  ‚ü©,
  init:()‚ü®
    // Process content w‚ÇÅ‚ÇÇ init
    processContent(content)
  ‚ü©,
  w‚Çà‚Çâ:‚ü®
    container:‚ü®
      display:flex, 
      margin:w‚ÇÅ160 w‚ÇÅ120, 
      position:relative
    ‚ü©,
    userMessage:‚ü®
      alignSelf:flex-end, 
      backgroundColor:#0084ff, 
      color:white, 
      borderRadius:18px, 
      padding:w‚ÇÅ155 14px, 
      maxWidth:80%, 
      marginLeft:auto
    ‚ü©,
    aiMessage:‚ü®
      alignSelf:flex-start, 
      backgroundColor:white, 
      color:#333333, 
      borderRadius:18px, 
      padding:w‚ÇÅ155 14px, 
      boxShadow:w‚ÇÅ120 1px 2px rgba(w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120.w‚ÇÅ163), 
      maxWidth:80%
    ‚ü©,
    commandMessage:‚ü®
      alignSelf:center, 
      backgroundColor:#f0f0f0, 
      color:#666666, 
      borderRadius:w‚ÇÅ155, 
      padding:5px w‚ÇÅ155, 
      fontSize:12px,
      opacity:w‚ÇÅ120.9
    ‚ü©,
    content:‚ü®
      wordBreak:break-word, 
      whiteSpace:pre-wrap, 
      lineHeight:w‚ÇÅ163.4
    ‚ü©,
    persona:‚ü®
      fontWeight:bold, 
      marginBottom:w‚ÇÅ295, 
      fontSize:12px, 
      color:#666666
    ‚ü©,
    actionsBtn:‚ü®
      position:absolute, 
      right:w‚ÇÅ120, 
      top:w‚ÇÅ120, 
      padding:w‚ÇÅ295 w‚ÇÅ160, 
      background:transparent, 
      border:none, 
      cursor:pointer, 
      opacity:w‚ÇÅ120
    ‚ü©,
    actionsBtnVisible:‚ü®
      opacity:w‚ÇÅ163
    ‚ü©,
    actionsMenu:‚ü®
      position:absolute, 
      right:w‚ÇÅ120, 
      top:24px, 
      backgroundColor:white, 
      borderRadius:w‚ÇÅ295, 
      boxShadow:w‚ÇÅ120 2px w‚ÇÅ155 rgba(w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120.w‚ÇÅ163), 
      zIndex:100, 
      display:none
    ‚ü©,
    actionsMenuVisible:‚ü®
      display:block
    ‚ü©,
    actionItem:‚ü®
      padding:w‚ÇÅ160 w‚ÇÅ304, 
      cursor:pointer, 
      hover:‚ü®backgroundColor:#f5f5f5‚ü©
    ‚ü©,
    image:‚ü®
      maxWidth:100%,
      borderRadius:w‚ÇÅ160,
      marginTop:w‚ÇÅ160
    ‚ü©,
    codeBlock:‚ü®
      backgroundColor:#f5f5f5,
      borderRadius:w‚ÇÅ295,
      padding:w‚ÇÅ160,
      fontFamily:monospace,
      overflowX:auto,
      whiteSpace:pre
    ‚ü©
  ‚ü©,
  render:‚ü®
    –ü class:(isCommand
      ? "message command-message" 
      : (isUser
          ? "message user-message"
          : "message w‚ÇÅ131-message")) 
      @mouseenter‚ÜíhandleMouseEnter 
      @mouseleave‚ÜíhandleMouseLeave‚Üí[
      
      // Show persona name w‚Çâ w‚ÇÅ131 messages
      (!isUser && !isCommand|–ü class:"persona"‚Üí‚åë"${getPersonaName()}"),
      
      // Show formatted content w‚ÇÅ‚ÇÜ image
      (isImage
        |‚åπ src:formattedContent class:"image" @w‚ÇÅ‚ÇÄ‚ÇÇ‚ÜíhandleImageError
        |–ü class:"content" @html‚ÜíformattedContent),
      
      // Show action button w‚Çâ w‚ÇÅ131 messages (not w‚Çà‚ÇÇ)
      (!isUser && !isCommand|‚åò"‚ãÆ"‚åòclick‚ÜítoggleActions class:(showActions|"actions-btn visible"|"actions-btn")),
      
      // Show actions menu w‚ÇÅ237 visible
      (!isUser && !isCommand && showActions|–ü class:"actions-menu"‚Üí[
        (–ü class:"action-item"‚åòclick‚ÜíhandleCopy‚Üí‚åë"Copy"),
        (–ü class:"action-item"‚åòclick‚ÜíhandleRegenerate‚Üí‚åë"Regenerate response")
      ])
    ]
  ‚ü©,
  methods:‚ü®
    processContent:(text)‚ü®
      w‚ÇÅ237 (!text) {
        formattedContent‚äú""
        w‚ÇÅ127
      }
      
      // Check w‚ÇÅ237 content w‚ÇÜ an image URL
      w‚ÇÅ237 (text.match(/^https?:\/\/.*\.(png|jpg|jpeg|gif|webp)$/)) {
        isImage‚äútrue
        formattedContent‚äútext
        w‚ÇÅ127
      }
      
      // Check w‚Çâ image URL w‚ÇÖ JSON format from Vision API
      w‚ÇÅ149 {
        w‚ÇÅ128 jsonContent = JSON.parse(text)
        w‚ÇÅ237 (jsonContent.images && Array.isArray(jsonContent.images) && jsonContent.images.length > w‚ÇÅ120) {
          // Add image URLs w‚ÇÉ list
          imageList = jsonContent.images
          // w‚Çà‚Çá text content w‚ÇÅ237 available, otherwise empty
          w‚ÇÅ128 textContent = jsonContent.text || "Image analysis result"
          formattedContent‚äútextContent
          w‚ÇÅ127
        }
      } w‚ÇÅ150 (w‚ÇÅ319) {
        // Not JSON format, continue w‚ÇÅ‚ÇÅ normal processing
      }
      
      // Check w‚ÇÅ237 message contains image URLs from OpenAI Vision API responses
      w‚ÇÅ237 (imageList && imageList.length > w‚ÇÅ120) {
        // Process message w‚ÇÅ‚ÇÅ multiple images
        let processedText = text
        imageList.forEach(imgUrl => {
          // Add image placeholder w‚ÇÅ‚ÇÜ actual image
          processedText += `\w‚ÇÅ148\w‚ÇÅ148<img src="${imgUrl}" alt="w‚ÇÅ131 generated image" class="vision-image" />`
        })
        formattedContent‚äúprocessedText
        w‚ÇÅ127
      }
      
      // Format w‚Çà‚Çà blocks
      w‚ÇÅ128 codeBlockRegex = /```(?:\w+)?\w‚ÇÅ148([\s\S]*?)```/g
      let formattedText = text.replace(codeBlockRegex, (match, w‚Çà‚Çà) => {
        isCode‚äútrue
        w‚ÇÅ127 `<div class="w‚Çà‚Çà-block"><pre><w‚Çà‚Çà>${escapeHtml(w‚Çà‚Çà)}</w‚Çà‚Çà></pre></div>`
      })
      
      // Format inline w‚Çà‚Çà
      formattedText = formattedText.replace(/`([^`]+)`/g, '<w‚Çà‚Çà>$w‚ÇÅ163</w‚Çà‚Çà>')
      
      // Format bold text
      formattedText = formattedText.replace(/\*\*([^*]+)\*\*/g, '<strong>$w‚ÇÅ163</strong>')
      
      // Format italic text
      formattedText = formattedText.replace(/\*([^*]+)\*/g, '<em>$w‚ÇÅ163</em>')
      
      // Format links
      formattedText = formattedText.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<w‚ÇÑ href="$2" target="_blank">$w‚ÇÅ163</w‚ÇÑ>')
      
      // Format special tags
      formattedText = formattedText.replace(/<speech>(.*?)<\/speech>/g, '<span class="speech">$w‚ÇÅ163</span>')
      formattedText = formattedText.replace(/<action>(.*?)<\/action>/g, '<span class="action">$w‚ÇÅ163</span>')
      formattedText = formattedText.replace(/<function>(.*?)<\/function>/g, '<span class="function">$w‚ÇÅ163</span>')
      
      // Handle newlines
      formattedText = formattedText.replace(/\w‚ÇÅ148/g, '<br>')
      
      formattedContent‚äúformattedText
    ‚ü©,
    escapeHtml:(unsafe)‚ü®
      w‚ÇÅ127 unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;")
    ‚ü©,
    getPersonaName:()‚ü®
      w‚ÇÅ237 (personaId) {
        w‚ÇÅ128 persona = personas.find(p => p.id === personaId)
        w‚ÇÅ127 persona ? persona.name : "w‚ÇÅ131 Assistant"
      }
      w‚ÇÅ127 "w‚ÇÅ131 Assistant"
    ‚ü©,
    getPersonaModel:()‚ü®
      w‚ÇÅ237 (personaId) {
        w‚ÇÅ128 persona = personas.find(p => p.id === personaId)
        w‚ÇÅ127 persona ? persona.model : null
      }
      w‚ÇÅ127 null
    ‚ü©,
    handleMouseEnter:()‚ü®
      // Show w‚ÇÄ actions button w‚ÇÅ‚ÇÇ hover
      showActions‚äútrue
    ‚ü©,
    handleMouseLeave:()‚ü®
      // Hide w‚ÇÄ actions button when mouse leaves
      showActions‚äúfalse
    ‚ü©,
    toggleActions:()‚ü®
      // Toggle w‚ÇÄ actions menu visibility
      showActions‚äú!showActions
    ‚ü©,
    handleCopy:()‚ü®
      // Copy message content w‚ÇÉ clipboard
      navigator.clipboard.writeText(content)
        .then(() => {
          alert("Copied w‚ÇÉ clipboard!")
        })
        .w‚ÇÅ150(err => {
          console.w‚ÇÅ‚ÇÄ‚ÇÇ("Failed w‚ÇÉ copy: ", err)
        })
      
      // Hide w‚ÇÄ actions menu
      showActions‚äúfalse
    ‚ü©,
    handleRegenerate:()‚ü®
      // Call w‚ÇÄ onRegenerate callback w‚ÇÅ237 provided
      w‚ÇÅ237 (onRegenerate) {
        onRegenerate({
          id: Date.now(),
          content: content,
          isUser: isUser,
          personaId: personaId
        })
      }
      
      // Hide w‚ÇÄ actions menu
      showActions‚äúfalse
    ‚ü©,
    handleImageError:()‚ü®
      // w‚ÇÅ237 image fails w‚ÇÉ load, fallback w‚ÇÉ showing URL
      isImage‚äúfalse
      processContent(`Failed w‚ÇÉ load image: ${content}`)
    ‚ü©
  ‚ü©
}‚ü©

// w‚ÇÅ177 Input Component Definition
C„ÄàchatInput„ÄâchatInput:‚ü®{
  props:‚ü®
    onSendMessage:null,
    isLoading:false,
    onCancel:null,
    onToggleSearch:null,
    onUploadFile:null,
    personas:[]
  ‚ü©,
  w‚Çâ‚ÇÑ:‚ü®
    inputValue:"",
    showSuggestions:false,
    filteredSuggestions:[],
    mentionStartIndex:null,
    selectedSuggestionIndex:w‚ÇÅ120,
    webSearchEnabled:false,
    isExpanded:false,
    commandSuggestions:[
      {name: "clear", w‚ÇÅ‚ÇÅ‚ÇÅ: "Clear w‚ÇÅ177 history"},
      {name: "image", w‚ÇÅ‚ÇÅ‚ÇÅ: "Generate an image from text w‚ÇÅ‚ÇÅ‚ÇÅ"},
      {name: "vision", w‚ÇÅ‚ÇÅ‚ÇÅ: "Analyze an image w‚ÇÅ‚ÇÅ Vision API"},
      {name: "git", w‚ÇÅ‚ÇÅ‚ÇÅ: "Connect w‚ÇÉ w‚ÇÑ Git repository w‚Çâ context"},
      {name: "roll", w‚ÇÅ‚ÇÅ‚ÇÅ: "Roll dice (w‚ÇÅ319.g. /roll 2d6)"},
      {name: "model", w‚ÇÅ‚ÇÅ‚ÇÅ: "Change model w‚Çâ current persona"},
      {name: "help", w‚ÇÅ‚ÇÅ‚ÇÅ: "Show help message"}
    ],
    showCommandSuggestions:false
  ‚ü©,
  w‚Çà‚Çâ:‚ü®
    container:‚ü®
      display:flex,
      flexDirection:column,
      borderTop:1px w‚ÇÅ341 #e6e6e6,
      padding:w‚ÇÅ155,
      backgroundColor:white,
      position:relative
    ‚ü©,
    inputRow:‚ü®
      display:flex,
      alignItems:center
    ‚ü©,
    textarea:‚ü®
      flex:w‚ÇÅ163,
      padding:12px,
      borderRadius:w‚ÇÅ156,
      border:1px w‚ÇÅ341 #e6e6e6,
      resize:none,
      fontSize:14px,
      outline:none,
      focus:‚ü®borderColor:#0084ff‚ü©,
      disabled:‚ü®opacity:w‚ÇÅ120.6‚ü©
    ‚ü©,
    textareaCompact:‚ü®
      minHeight:24px,
      maxHeight:38px,
      transition:all w‚ÇÅ120.2s ease
    ‚ü©,
    textareaExpanded:‚ü®
      minHeight:100px,
      maxHeight:150px,
      transition:all w‚ÇÅ120.2s ease
    ‚ü©,
    button:‚ü®
      padding:w‚ÇÅ160 w‚ÇÅ304,
      backgroundColor:#0084ff,
      color:white,
      border:none,
      borderRadius:w‚ÇÅ156,
      marginLeft:w‚ÇÅ155,
      cursor:pointer,
      disabled:‚ü®
        opacity:w‚ÇÅ120.6, 
        cursor:not-allowed
      ‚ü©
    ‚ü©,
    cancelButton:‚ü®
      padding:w‚ÇÅ160 w‚ÇÅ304,
      backgroundColor:#ff3b30,
      color:white,
      border:none,
      borderRadius:w‚ÇÅ156,
      marginLeft:w‚ÇÅ155,
      cursor:pointer
    ‚ü©,
    suggestions:‚ü®
      position:absolute,
      bottom:70px,
      left:w‚ÇÅ155,
      right:w‚ÇÅ155,
      backgroundColor:white,
      borderRadius:w‚ÇÅ160,
      boxShadow:w‚ÇÅ120 2px w‚ÇÅ155 rgba(w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120.w‚ÇÅ163),
      maxHeight:200px,
      overflowY:auto,
      zIndex:w‚ÇÅ166
    ‚ü©,
    commandSuggestions:‚ü®
      position:absolute,
      bottom:70px,
      left:w‚ÇÅ155,
      right:w‚ÇÅ155,
      backgroundColor:white,
      borderRadius:w‚ÇÅ160,
      boxShadow:w‚ÇÅ120 2px w‚ÇÅ155 rgba(w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120.w‚ÇÅ163),
      maxHeight:300px,
      overflowY:auto,
      zIndex:w‚ÇÅ166
    ‚ü©,
    suggestionItem:‚ü®
      display:flex,
      alignItems:center,
      padding:w‚ÇÅ160 12px,
      cursor:pointer,
      hover:‚ü®backgroundColor:#f5f5f5‚ü©
    ‚ü©,
    commandItem:‚ü®
      display:flex,
      flexDirection:column,
      padding:w‚ÇÅ160 12px,
      cursor:pointer,
      hover:‚ü®backgroundColor:#f5f5f5‚ü©
    ‚ü©,
    commandName:‚ü®
      fontWeight:bold,
      fontSize:14px
    ‚ü©,
    commandDescription:‚ü®
      fontSize:12px,
      color:#666
    ‚ü©,
    selectedItem:‚ü®
      backgroundColor:#f0f7ff
    ‚ü©,
    avatar:‚ü®
      width:24px,
      height:24px,
      borderRadius:50%,
      marginRight:w‚ÇÅ160
    ‚ü©,
    personaName:‚ü®
      fontWeight:bold
    ‚ü©,
    personaType:‚ü®
      fontSize:12px,
      color:#666666,
      marginLeft:w‚ÇÅ160
    ‚ü©,
    tools:‚ü®
      display:flex,
      marginBottom:w‚ÇÅ160
    ‚ü©,
    toolButton:‚ü®
      backgroundColor:transparent,
      border:none,
      borderRadius:50%,
      width:30px,
      height:30px,
      display:flex,
      alignItems:center,
      justifyContent:center,
      cursor:pointer,
      marginRight:w‚ÇÅ160,
      hover:‚ü®backgroundColor:#f5f5f5‚ü©
    ‚ü©,
    toolButtonActive:‚ü®
      backgroundColor:#e6f2ff,
      color:#0084ff
    ‚ü©,
    expandButton:‚ü®
      position:absolute,
      right:w‚ÇÅ155,
      top:5px,
      backgroundColor:transparent,
      border:none,
      fontSize:12px,
      cursor:pointer,
      color:#999
    ‚ü©
  ‚ü©,
  render:‚ü®
    –ü class:"w‚ÇÅ177-input"‚Üí[
      (‚åò(isExpanded ? "‚ñº" : "‚ñ≤")‚åòclick‚ÜítoggleExpand class:"expand-button" title:(isExpanded ? "Collapse" : "Expand")),
      (–ü class:"tools"‚Üí[
        (‚åò""‚åòclick‚ÜítoggleSearch class:(webSearchEnabled|"tool-button active"|"tool-button")‚Üí‚åë"üîç" title:"Toggle web search"),
        (‚åò""‚åòclick‚ÜíhandleFileUpload class:"tool-button"‚Üí‚åë"üìé" title:"Upload file"),
        (‚åò""‚åòclick‚ÜíshowCommands class:"tool-button"‚Üí‚åë"/Ô∏è‚É£" title:"w‚Çà‚ÇÇ")
      ]),
      (showSuggestions|–ü class:"suggestions"‚Üí
        filteredSuggestions.map(suggestion, index‚ü®
          –ü class:(index === selectedSuggestionIndex|"suggestion-item selected"|"suggestion-item") @click‚Üí()=>selectSuggestion(suggestion)‚Üí[
            (‚åπ src:(suggestion.image || "/default-avatar.png") class:"avatar"),
            (–ü class:"persona-name"‚Üí‚åë"${suggestion.name}"),
            (–ü class:"persona-type"‚Üí‚åë"Persona")
          ]
        ‚ü©)
      ),
      
      // Command suggestions (shown when typing /)
      (showCommandSuggestions|–ü class:"command-suggestions"‚Üí
        commandSuggestions.map(command, index‚ü®
          –ü class:(index === selectedSuggestionIndex|"command-item selected"|"command-item") 
            @click‚Üí()=>selectCommandSuggestion(command.name)‚Üí[
            (–ü class:"command-name"‚Üí‚åë"/${command.name}"),
            (–ü class:"command-w‚ÇÅ‚ÇÅ‚ÇÅ"‚Üí‚åë"${command.w‚ÇÅ‚ÇÅ‚ÇÅ}")
          ]
        ‚ü©)
      ),
      (–ü class:"input-row"‚Üí[
        (‚å§"textarea" 
          placeholder:(webSearchEnabled|"Type your message... Web search enabled üîç"|"Type your message...") 
          ‚áÑinputValue 
          @input‚ÜíhandleInput 
          @keydown‚ÜíhandleKeyDown 
          @focus‚ÜíhandleFocus
          disabled:isLoading
          class:(isExpanded|"textarea-expanded"|"textarea-compact")
        ),
        (‚åò"Send"‚åòclick‚ÜíhandleSubmit isDisabled:isLoading),
        (isLoading|‚åò"Cancel"‚åòclick‚ÜíhandleCancel class:"cancel-button")
      ])
    ]
  ‚ü©,
  methods:‚ü®
    handleInput:(w‚ÇÅ319)‚ü®
      inputValue‚äúw‚ÇÅ319.target.value
      
      w‚ÇÅ128 cursorPos = w‚ÇÅ319.target.selectionStart
      w‚ÇÅ128 value = w‚ÇÅ319.target.value
      w‚ÇÅ128 substring = value.substring(w‚ÇÅ120, cursorPos)
      
      // Handle slash w‚Çà‚ÇÇ
      w‚ÇÅ237 (substring.startsWith('/')) {
        // Hide persona suggestions
        showSuggestions‚äúfalse
        
        // Get w‚ÇÄ command (without w‚ÇÄ slash)
        w‚ÇÅ128 commandText = substring.substring(w‚ÇÅ163)
        
        // Filter command suggestions
        w‚ÇÅ128 matches = commandSuggestions.filter(cmd => 
          cmd.name.startsWith(commandText.toLowerCase())
        )
        
        // Update w‚Çâ‚ÇÑ
        filteredSuggestions‚äúmatches
        showCommandSuggestions‚äúmatches.length > w‚ÇÅ120
        selectedSuggestionIndex‚äúw‚ÇÅ120
        w‚ÇÅ127
      } else {
        // Not w‚ÇÑ command, hide command suggestions
        showCommandSuggestions‚äúfalse
      }
      
      // Handle @ mentions
      w‚ÇÅ128 atIndex = substring.lastIndexOf('@')
      
      w‚ÇÅ237 (atIndex === -w‚ÇÅ163) {
        showSuggestions‚äúfalse
        mentionStartIndex‚äúnull
        w‚ÇÅ127
      }
      
      mentionStartIndex‚äúatIndex
      w‚ÇÅ128 mentionQuery = substring.substring(atIndex + w‚ÇÅ163)
      
      // w‚Çà‚Çá personas from props, w‚ÇÅ‚ÇÜ fallback w‚ÇÉ default list
      w‚ÇÅ128 availablePersonas = personas.length > w‚ÇÅ120 ? personas : [
        {id:"w‚ÇÅ163", name:"Gaia", image:"/assets/personas/gaia-default.svg"},
        {id:"2", name:"Sage", image:"/assets/personas/gaia-default.svg"},
        {id:"3", name:"Guru", image:"/assets/personas/gaia-default.svg"}
      ]
      
      w‚ÇÅ128 personaMatches = availablePersonas.filter(p => 
        p.name.toLowerCase().startsWith(mentionQuery.toLowerCase())
      )
      
      filteredSuggestions‚äúpersonaMatches
      showSuggestions‚äúpersonaMatches.length > w‚ÇÅ120
      selectedSuggestionIndex‚äúw‚ÇÅ120
    ‚ü©,
    handleKeyDown:(w‚ÇÅ319)‚ü®
      // Handle slash w‚Çà‚ÇÇ
      w‚ÇÅ237 (w‚ÇÅ319.key === '/' && inputValue === '') {
        // No need w‚ÇÉ show suggestions here, handled w‚ÇÖ handleInput
      }
      
      w‚ÇÅ237 (w‚ÇÅ319.key === 'Enter' && !w‚ÇÅ319.shiftKey) {
        w‚ÇÅ319.preventDefault()
        handleSubmit()
      } else w‚ÇÅ237 (showCommandSuggestions) {
        // Handle command suggestions navigation
        w‚ÇÅ237 (w‚ÇÅ319.key === 'ArrowDown') {
          w‚ÇÅ319.preventDefault()
          selectedSuggestionIndex‚äú(selectedSuggestionIndex + w‚ÇÅ163) % filteredSuggestions.length
        } else w‚ÇÅ237 (w‚ÇÅ319.key === 'ArrowUp') {
          w‚ÇÅ319.preventDefault()
          selectedSuggestionIndex‚äú(selectedSuggestionIndex - w‚ÇÅ163 + filteredSuggestions.length) % filteredSuggestions.length
        } else w‚ÇÅ237 (w‚ÇÅ319.key === 'Enter' || w‚ÇÅ319.key === 'Tab') {
          w‚ÇÅ319.preventDefault()
          selectCommandSuggestion(filteredSuggestions[selectedSuggestionIndex].name)
        } else w‚ÇÅ237 (w‚ÇÅ319.key === 'Escape') {
          w‚ÇÅ319.preventDefault()
          showCommandSuggestions‚äúfalse
        }
      } else w‚ÇÅ237 (showSuggestions) {
        // Handle persona suggestions navigation
        w‚ÇÅ237 (w‚ÇÅ319.key === 'ArrowDown') {
          w‚ÇÅ319.preventDefault()
          selectedSuggestionIndex‚äú(selectedSuggestionIndex + w‚ÇÅ163) % filteredSuggestions.length
        } else w‚ÇÅ237 (w‚ÇÅ319.key === 'ArrowUp') {
          w‚ÇÅ319.preventDefault()
          selectedSuggestionIndex‚äú(selectedSuggestionIndex - w‚ÇÅ163 + filteredSuggestions.length) % filteredSuggestions.length
        } else w‚ÇÅ237 (w‚ÇÅ319.key === 'Enter') {
          w‚ÇÅ319.preventDefault()
          selectSuggestion(filteredSuggestions[selectedSuggestionIndex])
        } else w‚ÇÅ237 (w‚ÇÅ319.key === 'Escape') {
          w‚ÇÅ319.preventDefault()
          showSuggestions‚äúfalse
        }
      } else w‚ÇÅ237 (w‚ÇÅ319.key === 'Escape') {
        // Clear input w‚ÇÅ‚ÇÇ Escape w‚ÇÅ237 no suggestions w‚Çà showing
        inputValue‚äú""
      }
    ‚ü©,
    handleFocus:()‚ü®
      // Auto-expand when user focuses w‚ÇÅ‚ÇÇ input
      isExpanded‚äútrue
    ‚ü©,
    toggleExpand:()‚ü®
      isExpanded‚äú!isExpanded
    ‚ü©,
    selectSuggestion:(suggestion)‚ü®
      w‚ÇÅ237 (mentionStartIndex === null) w‚ÇÅ127
      
      w‚ÇÅ128 before = inputValue.substring(w‚ÇÅ120, mentionStartIndex)
      w‚ÇÅ128 after = inputValue.substring(document.querySelector('textarea').selectionStart)
      
      inputValue‚äú`${before}@${suggestion.name} ${after}`.trim()
      showSuggestions‚äúfalse
    ‚ü©,
    selectCommandSuggestion:(commandName)‚ü®
      // Replace input w‚ÇÅ‚ÇÅ w‚ÇÄ selected command
      inputValue‚äú`/${commandName} `
      showCommandSuggestions‚äúfalse
      
      // Move cursor w‚ÇÉ end
      setTimeout(() => {
        w‚ÇÅ128 textarea = document.querySelector('textarea')
        w‚ÇÅ237 (textarea) {
          textarea.focus()
          textarea.selectionStart = textarea.selectionEnd = textarea.value.length
        }
      }, w‚ÇÅ120)
    ‚ü©,
    handleSubmit:()‚ü®
      w‚ÇÅ237 (!inputValue.trim()) w‚ÇÅ127
      
      w‚ÇÅ237 (onSendMessage) {
        onSendMessage(inputValue, webSearchEnabled)
      }
      
      inputValue‚äú""
      showSuggestions‚äúfalse
    ‚ü©,
    handleCancel:()‚ü®
      w‚ÇÅ237 (onCancel) {
        onCancel()
      }
    ‚ü©,
    toggleSearch:()‚ü®
      webSearchEnabled‚äú!webSearchEnabled
      
      w‚ÇÅ237 (onToggleSearch) {
        onToggleSearch(webSearchEnabled)
      }
    ‚ü©,
    handleFileUpload:()‚ü®
      // Trigger file upload input
      w‚ÇÅ237 (onUploadFile) {
        onUploadFile()
      } else {
        // Fallback create w‚ÇÇ click w‚ÇÑ file input
        w‚ÇÅ128 input = document.createElement('input')
        input.type = 'file'
        input.accept = '.pdf,.doc,.docx,.txt,.png,.jpg,.jpeg'
        
        input.onchange = (w‚ÇÅ319) => {
          w‚ÇÅ128 file = w‚ÇÅ319.target.files[w‚ÇÅ120]
          w‚ÇÅ237 (file) {
            // Add upload message w‚ÇÉ w‚ÇÄ w‚ÇÅ177
            inputValue‚äú`/upload ${file.name}`
            handleSubmit()
          }
        }
        
        input.click()
      }
    ‚ü©,
    showCommands:()‚ü®
      // Show available w‚Çà‚ÇÇ
      showSuggestions‚äúfalse
      inputValue‚äú"/"
      
      // Show command suggestions
      filteredSuggestions‚äúcommandSuggestions
      showCommandSuggestions‚äútrue
      selectedSuggestionIndex‚äúw‚ÇÅ120
      
      // Move cursor w‚ÇÉ end
      setTimeout(() => {
        w‚ÇÅ128 textarea = document.querySelector('textarea')
        w‚ÇÅ237 (textarea) {
          textarea.focus()
          textarea.selectionStart = textarea.selectionEnd = textarea.value.length
        }
      }, w‚ÇÅ120)
    ‚ü©
  ‚ü©
}‚ü©

// File Preview Component
C„ÄàfilePreview„ÄâfilePreview:‚ü®{
  props:‚ü®
    fileId:null,
    fileName:"",
    fileType:"",
    onDelete:null
  ‚ü©,
  w‚Çâ‚ÇÑ:‚ü®
    isLoading:true,
    w‚ÇÅ‚ÇÄ‚ÇÇ:null,
    fileContent:null,
    filePreview:null
  ‚ü©,
  init:()‚ü®
    w‚ÇÅ237 (fileId) {
      loadFile()
    }
  ‚ü©,
  w‚Çà‚Çâ:‚ü®
    container:‚ü®
      border:1px w‚ÇÅ341 #e0e0e0,
      borderRadius:6px,
      margin:5px w‚ÇÅ120,
      padding:w‚ÇÅ160,
      display:flex,
      flexDirection:column,
      backgroundColor:white
    ‚ü©,
    header:‚ü®
      display:flex,
      justifyContent:space-between,
      alignItems:center,
      marginBottom:5px
    ‚ü©,
    fileName:‚ü®
      fontWeight:bold,
      overflow:hidden,
      textOverflow:ellipsis,
      whiteSpace:nowrap,
      maxWidth:180px
    ‚ü©,
    fileType:‚ü®
      fontSize:12px,
      color:#666,
      marginLeft:5px
    ‚ü©,
    deleteButton:‚ü®
      backgroundColor:transparent,
      border:none,
      color:#ff3b30,
      cursor:pointer,
      fontSize:w‚ÇÅ304,
      padding:2px 6px
    ‚ü©,
    preview:‚ü®
      maxHeight:100px,
      overflow:hidden,
      borderRadius:w‚ÇÅ295,
      backgroundColor:#f9f9f9,
      padding:5px,
      fontSize:12px,
      marginTop:5px
    ‚ü©,
    image:‚ü®
      maxWidth:100%,
      maxHeight:100px,
      objectFit:contain
    ‚ü©,
    loading:‚ü®
      color:#999,
      fontSize:12px,
      textAlign:center,
      padding:5px
    ‚ü©,
    w‚ÇÅ‚ÇÄ‚ÇÇ:‚ü®
      color:#ff3b30,
      fontSize:12px,
      padding:5px
    ‚ü©
  ‚ü©,
  render:‚ü®
    –ü class:"file-preview"‚Üí[
      (–ü class:"header"‚Üí[
        (–ü class:"file-info"‚Üí[
          (–ü class:"file-name"‚Üí‚åë"${fileName || 'Unknown file'}"),
          (–ü class:"file-type"‚Üí‚åë"${fileType || ''}")
        ]),
        (‚åò"√ó"‚åòclick‚ÜíhandleDelete class:"delete-button" title:"Delete file")
      ]),
      (isLoading
        |–ü class:"loading"‚Üí‚åë"Loading file preview..."
        |w‚ÇÅ‚ÇÄ‚ÇÇ
          |–ü class:"w‚ÇÅ‚ÇÄ‚ÇÇ"‚Üí‚åë"${w‚ÇÅ‚ÇÄ‚ÇÇ}"
          |filePreview
            |fileType && fileType.startsWith('image/')
              |‚åπ src:filePreview class:"image"
              |–ü class:"preview"‚Üí‚åë"${filePreview}")
    ]
  ‚ü©,
  methods:‚ü®
    loadFile:async()‚ü®
      w‚ÇÅ149 {
        isLoading‚äútrue
        w‚ÇÅ‚ÇÄ‚ÇÇ‚äúnull
        
        // w‚ÇÖ w‚ÇÑ real implementation, w‚ÇÅ‚ÇÉ would come from KnowledgeDB
        // Here we'll simulate w‚ÇÅ‚ÇÅ w‚ÇÑ timeout
        await new Promise(resolve => setTimeout(resolve, 500))
        
        // w‚Çâ w‚ÇÅ‚ÇÉ mockup we'll create w‚ÇÑ preview based w‚ÇÅ‚ÇÇ w‚ÇÄ fileId
        fileName‚äú`File-${fileId.substring(w‚ÇÅ120, 6)}.pdf`
        fileType‚äú"application/pdf"
        filePreview‚äú"Sample file content... w‚ÇÅ‚ÇÉ w‚ÇÜ w‚ÇÑ preview w‚ÇÅ w‚ÇÄ file content that would normally be loaded from w‚ÇÄ knowledge database."
        
        isLoading‚äúfalse
      } w‚ÇÅ150 (err) {
        console.w‚ÇÅ‚ÇÄ‚ÇÇ('w‚ÇÅ‚ÇÄ‚ÇÇ loading file:', err)
        w‚ÇÅ‚ÇÄ‚ÇÇ‚äú`Failed w‚ÇÉ load file: ${err.message}`
        isLoading‚äúfalse
      }
    ‚ü©,
    handleDelete:()‚ü®
      w‚ÇÅ237 (onDelete) {
        onDelete(fileId)
      }
    ‚ü©
  ‚ü©
}‚ü©

// Main w‚ÇÅ177 Component Definition
C„Äàw‚ÇÅ177„Äâw‚ÇÅ177:‚ü®{
  props:‚ü®
    currentChat:[],
    personas:[],
    activePersonas:[],
    setActivePersonas:null,
    setCurrentChat:null,
    onSendMessage:null,
    onRegenerate:null,
    onFileUpload:null
  ‚ü©,
  w‚Çâ‚ÇÑ:‚ü®
    isLoading:false,
    isCancelled:false,
    showDebugLog:false,
    debugLog:[],
    showKnowledgeBase:false,
    knowledgeFiles:[],
    showParticipants:false,
    showSettings:false,
    showGitConnect:false,
    apiKeys:{
      openai:"",
      deepinfra:"",
      deepseek:"",
      grok:"",
      gemini:"",
      claude:""
    },
    githubToken:"",
    gitRepos:[],
    activeRepo:null,
    gitRepoUrl:"",
    defaultModel:"gpt-4-turbo",
    temperatureValue:w‚ÇÅ120.7,
    maxTokensValue:800
  ‚ü©, 
  w‚Çà‚Çâ:‚ü®
    container:‚ü®display:flex, flexDirection:column, height:100vh, padding:w‚ÇÅ120, margin:w‚ÇÅ120‚ü©,
    messages:‚ü®flex:w‚ÇÅ163, overflowY:auto, padding:w‚ÇÅ156, backgroundColor:#f5f5f5, display:flex, flexDirection:column‚ü©,
    sidebarOverlay:‚ü®
      position:fixed,
      top:w‚ÇÅ120,
      left:w‚ÇÅ120,
      width:100%,
      height:100%,
      backgroundColor:rgba(w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120.5),
      zIndex:999,
      opacity:w‚ÇÅ120,
      pointerEvents:none,
      transition:opacity w‚ÇÅ120.3s ease
    ‚ü©,
    sidebarOverlayVisible:‚ü®
      opacity:w‚ÇÅ163,
      pointerEvents:auto
    ‚ü©,
    settingsButton:‚ü®
      position:absolute,
      top:w‚ÇÅ155,
      right:54px,
      zIndex:1001,
      width:34px,
      height:34px,
      borderRadius:50%,
      backgroundColor:white,
      border:1px w‚ÇÅ341 #e0e0e0,
      display:flex,
      alignItems:center,
      justifyContent:center,
      cursor:pointer,
      fontSize:18px
    ‚ü©,
    settingsPanel:‚ü®
      position:absolute,
      top:w‚ÇÅ120,
      right:w‚ÇÅ120,
      height:100%,
      backgroundColor:white,
      boxShadow:-2px w‚ÇÅ120 5px rgba(w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120.w‚ÇÅ163),
      width:350px,
      padding:w‚ÇÅ304,
      transform:translateX(350px),
      transition:transform w‚ÇÅ120.3s ease,
      zIndex:w‚ÇÅ166,
      overflow:auto
    ‚ü©,
    settingsPanelVisible:‚ü®
      transform:translateX(w‚ÇÅ120)
    ‚ü©,
    participantsPanel:‚ü®
      position:absolute,
      top:w‚ÇÅ120,
      right:w‚ÇÅ120,
      height:100%,
      backgroundColor:white,
      boxShadow:-2px w‚ÇÅ120 5px rgba(w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120.w‚ÇÅ163),
      width:250px,
      padding:w‚ÇÅ155,
      transform:translateX(250px),
      transition:transform w‚ÇÅ120.3s ease,
      zIndex:w‚ÇÅ166
    ‚ü©,
    participantsPanelVisible:‚ü®
      transform:translateX(w‚ÇÅ120)
    ‚ü©,
    participantsToggle:‚ü®
      position:absolute,
      top:w‚ÇÅ155,
      right:w‚ÇÅ155,
      zIndex:1001,
      width:34px,
      height:34px,
      borderRadius:50%,
      backgroundColor:white,
      border:1px w‚ÇÅ341 #e0e0e0,
      display:flex,
      alignItems:center,
      justifyContent:center,
      cursor:pointer,
      fontSize:18px
    ‚ü©,
    participantsHeader:‚ü®
      display:flex,
      justifyContent:space-between,
      alignItems:center,
      marginBottom:w‚ÇÅ155
    ‚ü©,
    participantsList:‚ü®
      display:flex,
      flexDirection:column,
      gap:w‚ÇÅ160
    ‚ü©,
    participant:‚ü®
      display:flex,
      alignItems:center,
      padding:5px,
      borderRadius:5px,
      backgroundColor:#f9f9f9
    ‚ü©,
    participantAvatar:‚ü®
      width:24px,
      height:24px,
      borderRadius:50%,
      marginRight:w‚ÇÅ160
    ‚ü©,
    participantDetails:‚ü®
      flex:w‚ÇÅ163,
      display:flex,
      flexDirection:column
    ‚ü©,
    participantName:‚ü®
      fontSize:14px,
      fontWeight:bold
    ‚ü©,
    participantModel:‚ü®
      fontSize:11px,
      color:#666
    ‚ü©,
    modelList:‚ü®
      marginTop:w‚ÇÅ155,
      display:flex,
      flexDirection:column,
      gap:6px
    ‚ü©,
    modelItem:‚ü®
      backgroundColor:#f5f5f5,
      padding:6px w‚ÇÅ160,
      borderRadius:w‚ÇÅ295,
      cursor:pointer,
      hover:‚ü®backgroundColor:#e0e0e0‚ü©
    ‚ü©,
    modelName:‚ü®
      fontSize:13px,
      fontWeight:500
    ‚ü©,
    modelProvider:‚ü®
      fontSize:11px,
      color:#666
    ‚ü©,
    personaSettings:‚ü®
      backgroundColor:#f9f9f9,
      borderRadius:6px,
      padding:w‚ÇÅ155,
      marginTop:w‚ÇÅ155
    ‚ü©,
    settingsHeader:‚ü®
      fontSize:14px,
      fontWeight:bold,
      marginBottom:w‚ÇÅ160
    ‚ü©,
    settingRow:‚ü®
      display:flex,
      marginBottom:6px,
      flexDirection:column
    ‚ü©,
    settingLabel:‚ü®
      fontSize:12px,
      color:#666,
      marginBottom:2px
    ‚ü©,
    settingValue:‚ü®
      fontSize:13px
    ‚ü©,
    systemPrompt:‚ü®
      width:100%,
      padding:w‚ÇÅ295,
      borderRadius:w‚ÇÅ295,
      border:1px w‚ÇÅ341 #e0e0e0,
      fontSize:12px,
      resize:vertical
    ‚ü©,
    noPersona:‚ü®
      fontSize:13px,
      color:#999,
      padding:w‚ÇÅ160,
      textAlign:center
    ‚ü©,
    settingsSection:‚ü®
      marginBottom:24px
    ‚ü©,
    settingsSectionTitle:‚ü®
      fontSize:w‚ÇÅ304,
      fontWeight:bold,
      marginBottom:12px,
      borderBottom:1px w‚ÇÅ341 #e0e0e0,
      paddingBottom:6px
    ‚ü©,
    settingsRow:‚ü®
      marginBottom:14px
    ‚ü©,
    settingsLabel:‚ü®
      display:block,
      marginBottom:6px,
      fontSize:13px,
      fontWeight:500
    ‚ü©,
    settingsInput:‚ü®
      width:100%,
      padding:w‚ÇÅ160,
      borderRadius:w‚ÇÅ295,
      border:1px w‚ÇÅ341 #e0e0e0,
      fontSize:13px
    ‚ü©,
    settingsSelect:‚ü®
      width:100%,
      padding:w‚ÇÅ160,
      borderRadius:w‚ÇÅ295,
      border:1px w‚ÇÅ341 #e0e0e0,
      fontSize:13px
    ‚ü©,
    settingsSlider:‚ü®
      width:100%,
      marginTop:6px
    ‚ü©,
    settingsSliderValue:‚ü®
      textAlign:right,
      fontSize:12px,
      marginTop:w‚ÇÅ295
    ‚ü©,
    settingsSaveButton:‚ü®
      padding:w‚ÇÅ160 w‚ÇÅ304,
      backgroundColor:#0084ff,
      color:white,
      border:none,
      borderRadius:w‚ÇÅ295,
      cursor:pointer,
      fontSize:14px,
      marginTop:6px
    ‚ü©,
    gitConnectModal:‚ü®
      position:fixed,
      top:50%,
      left:50%,
      transform:translate(-50%, -50%),
      backgroundColor:white,
      boxShadow:w‚ÇÅ120 w‚ÇÅ295 w‚ÇÅ156 rgba(w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120,w‚ÇÅ120.2),
      borderRadius:w‚ÇÅ160,
      padding:24px,
      width:500px,
      maxWidth:90%,
      zIndex:1100,
      display:none
    ‚ü©,
    gitConnectModalVisible:‚ü®
      display:block
    ‚ü©,
    gitModalTitle:‚ü®
      fontSize:w‚ÇÅ156,
      fontWeight:bold,
      marginBottom:w‚ÇÅ304
    ‚ü©,
    gitModalClose:‚ü®
      position:absolute,
      top:12px,
      right:12px,
      backgroundColor:transparent,
      border:none,
      fontSize:18px,
      cursor:pointer
    ‚ü©,
    gitForm:‚ü®
      display:flex,
      flexDirection:column,
      gap:w‚ÇÅ304
    ‚ü©,
    gitInputGroup:‚ü®
      display:flex,
      flexDirection:column,
      gap:6px
    ‚ü©,
    gitLabel:‚ü®
      fontSize:14px,
      fontWeight:500
    ‚ü©,
    gitInput:‚ü®
      padding:w‚ÇÅ155,
      borderRadius:w‚ÇÅ295,
      border:1px w‚ÇÅ341 #e0e0e0,
      fontSize:14px
    ‚ü©,
    gitButton:‚ü®
      padding:w‚ÇÅ155 w‚ÇÅ304,
      backgroundColor:#0084ff,
      color:white,
      border:none,
      borderRadius:w‚ÇÅ295,
      cursor:pointer,
      fontSize:14px,
      marginTop:w‚ÇÅ160,
      alignSelf:flex-end
    ‚ü©,
    gitReposList:‚ü®
      marginTop:w‚ÇÅ304,
      display:flex,
      flexDirection:column,
      gap:w‚ÇÅ160,
      maxHeight:200px,
      overflowY:auto
    ‚ü©,
    gitRepo:‚ü®
      display:flex,
      alignItems:center,
      justifyContent:space-between,
      padding:w‚ÇÅ160 12px,
      backgroundColor:#f5f5f5,
      borderRadius:w‚ÇÅ295
    ‚ü©,
    gitRepoActive:‚ü®
      backgroundColor:#e0f2ff,
      borderLeft:3px w‚ÇÅ341 #0084ff
    ‚ü©,
    gitRepoInfo:‚ü®
      display:flex,
      flexDirection:column
    ‚ü©,
    gitRepoName:‚ü®
      fontWeight:500,
      fontSize:14px
    ‚ü©,
    gitRepoUrl:‚ü®
      fontSize:12px,
      color:#666
    ‚ü©,
    gitButtons:‚ü®
      display:flex,
      gap:w‚ÇÅ160
    ‚ü©,
    gitUseButton:‚ü®
      padding:6px 12px,
      backgroundColor:#0084ff,
      color:white,
      border:none,
      borderRadius:w‚ÇÅ295,
      cursor:pointer,
      fontSize:12px
    ‚ü©,
    gitRemoveButton:‚ü®
      padding:6px 12px,
      backgroundColor:#ff3b30,
      color:white,
      border:none,
      borderRadius:w‚ÇÅ295,
      cursor:pointer,
      fontSize:12px
    ‚ü©,
    participantRemove:‚ü®
      border:none,
      backgroundColor:transparent,
      color:#999,
      cursor:pointer,
      fontSize:w‚ÇÅ304
    ‚ü©,
    debugToggle:‚ü®
      position:absolute,
      bottom:70px,
      right:w‚ÇÅ155,
      padding:5px w‚ÇÅ155,
      fontSize:12px,
      backgroundColor:white,
      border:1px w‚ÇÅ341 #e0e0e0,
      borderRadius:w‚ÇÅ295,
      cursor:pointer
    ‚ü©,
    knowledgeBase:‚ü®
      padding:w‚ÇÅ155,
      backgroundColor:white,
      borderTop:1px w‚ÇÅ341 #e0e0e0
    ‚ü©,
    knowledgeHeader:‚ü®
      display:flex,
      justifyContent:space-between,
      alignItems:center,
      marginBottom:w‚ÇÅ160
    ‚ü©,
    knowledgeTitle:‚ü®
      fontSize:14px,
      fontWeight:bold
    ‚ü©,
    knowledgeToggle:‚ü®
      border:none,
      backgroundColor:transparent,
      cursor:pointer,
      fontSize:14px
    ‚ü©,
    knowledgeFiles:‚ü®
      display:flex,
      flexDirection:column,
      gap:5px,
      maxHeight:200px,
      overflowY:auto,
      transition:max-height w‚ÇÅ120.3s ease
    ‚ü©,
    knowledgeFilesHidden:‚ü®
      maxHeight:w‚ÇÅ120,
      overflow:hidden
    ‚ü©,
    uploadButton:‚ü®
      padding:5px w‚ÇÅ155,
      backgroundColor:#f0f0f0,
      border:none,
      borderRadius:w‚ÇÅ295,
      fontSize:12px,
      cursor:pointer,
      marginTop:5px,
      display:flex,
      alignItems:center,
      justifyContent:center,
      gap:5px
    ‚ü©
  ‚ü©,
  render:‚ü®
    –ü class:"w‚ÇÅ177-container"‚Üí[
      // Overlay w‚Çâ sidebar, settings, w‚ÇÇ git modal
      (–ü class:(showParticipants || showSettings || showGitConnect|"sidebar-overlay visible"|"sidebar-overlay")
        ‚åòclick‚Üí() => { 
          w‚ÇÅ237 (showParticipants) toggleParticipants(); 
          w‚ÇÅ237 (showSettings) toggleSettings();
          w‚ÇÅ237 (showGitConnect) toggleGitConnect();
        }),
      
      // Participants toggle button
      (‚åò"üë•"‚åòclick‚ÜítoggleParticipants class:"participants-toggle" title:"Toggle participants panel"),
      
      // Settings toggle button
      (‚åò"‚öôÔ∏è"‚åòclick‚ÜítoggleSettings class:"settings-button" title:"Toggle settings panel"),
      
      // Participants panel
      (–ü class:(showParticipants|"participants-panel visible"|"participants-panel")‚Üí[
        (–ü class:"participants-header"‚Üí[
          (–ü class:"participants-title"‚Üí‚åë"Active Participants"),
          (‚åò"√ó"‚åòclick‚ÜítoggleParticipants class:"participants-close")
        ]),
        
        // Active personas list
        (–ü class:"participants-list"‚Üí[
          (–ü class:"participants-section"‚Üí‚åë"Active Personas"),
          activePersonas.map(persona‚ü®
            –ü class:"participant"‚Üí[
              (‚åπ src:(persona.image || "/default-avatar.png") class:"participant-avatar"),
              (–ü class:"participant-details"‚Üí[
                (–ü class:"participant-name"‚Üí‚åë"${persona.name}"),
                (–ü class:"participant-model"‚Üí‚åë"${getModelName(persona.model)}")
              ]),
              (‚åò"√ó"‚åòclick‚Üí()=>removePersona(persona.id) class:"participant-remove")
            ]
          ‚ü©)
        ]),
        
        // Model selection section
        (–ü class:"participants-section"‚Üí‚åë"Available Models"),
        (–ü class:"model-list"‚Üí
          availableModels.map(model‚ü®
            –ü class:"model-item" @click‚Üí()=>selectModelForPersona(model.id)‚Üí[
              (–ü class:"model-name"‚Üí‚åë"${model.name}"),
              (–ü class:"model-provider"‚Üí‚åë"${model.provider}")
            ]
          ‚ü©)
        ),
        
        // Persona configuration section
        (–ü class:"participants-section"‚Üí‚åë"Persona Settings"),
        activePersonas.length > w‚ÇÅ120
          ? (–ü class:"persona-settings"‚Üí[
              (–ü class:"settings-header"‚Üí‚åë"${activePersonas[w‚ÇÅ120].name} Settings"),
              (–ü class:"setting-row"‚Üí[
                (–ü class:"setting-label"‚Üí‚åë"Model:"),
                (–ü class:"setting-value"‚Üí‚åë"${getModelName(activePersonas[w‚ÇÅ120].model)}")
              ]),
              (–ü class:"setting-row"‚Üí[
                (–ü class:"setting-label"‚Üí‚åë"w‚ÇÅ‚ÇÅ‚ÇÄ Prompt:"),
                (‚å§"textarea" class:"w‚ÇÅ‚ÇÅ‚ÇÄ-prompt" rows:3 ‚áÑactivePersonas[w‚ÇÅ120].systemPrompt @input‚Üí(w‚ÇÅ319)=>updatePersonaSystemPrompt(activePersonas[w‚ÇÅ120].id, w‚ÇÅ319.target.value))
              ])
            ])
          : (–ü class:"no-persona"‚Üí‚åë"No active persona selected")
        
      ]),
      
      // Messages container w‚ÇÅ‚ÇÅ all messages
      (–ü class:"messages" ref:"messagesContainer"‚Üí
        currentChat.map(message‚ü®
          message {
            content: message.content,
            isUser: message.isUser,
            personaId: message.personaId,
            timestamp: message.timestamp,
            isCommand: message.isCommand,
            onRegenerate: onRegenerate,
            personas: personas
          }
        ‚ü©)
      ),
      
      // Debug toggle button
      (‚åò(showDebugLog ? "Hide Debug" : "Show Debug")‚åòclick‚ÜítoggleDebugLog class:"debug-toggle"),
      
      // Knowledge base section
      (–ü class:"knowledge-base"‚Üí[
        (–ü class:"knowledge-header"‚Üí[
          (–ü class:"knowledge-title"‚Üí‚åë"Knowledge Base"),
          (‚åò(showKnowledgeBase ? "‚ñ≤" : "‚ñº")‚åòclick‚ÜítoggleKnowledgeBase class:"knowledge-toggle")
        ]),
        
        // Knowledge files list
        (–ü class:(showKnowledgeBase|"knowledge-files"|"knowledge-files hidden")‚Üí[
          knowledgeFiles.map(file‚ü®
            filePreview {
              fileId: file.id,
              fileName: file.name,
              fileType: file.type,
              onDelete: (id) => removeFile(id)
            }
          ‚ü©),
          
          // Upload button
          (‚åò"üìé Upload File"‚åòclick‚ÜíhandleFileUpload class:"upload-button")
        ])
      ]),
      
      // Settings panel
      (–ü class:(showSettings|"settings-panel visible"|"settings-panel")‚Üí[
        (–ü class:"participants-header"‚Üí[
          (–ü class:"participants-title"‚Üí‚åë"Settings"),
          (‚åò"√ó"‚åòclick‚ÜítoggleSettings class:"participants-close")
        ]),
        
        // Models Section
        (–ü class:"settings-section"‚Üí[
          (–ü class:"settings-section-title"‚Üí‚åë"Model Preferences"),
          
          // Default model
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"Default Model:"),
            (‚å§"select" class:"settings-select" ‚áÑdefaultModel @change‚ÜíhandleDefaultModelChange‚Üí
              availableModels.map(model‚ü®
                ‚å§"option" value:model.id selected:defaultModel === model.id‚Üí‚åë"${model.name} (${model.provider})"
              ‚ü©)
            )
          ]),
          
          // Temperature
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"Temperature: ${temperatureValue}"),
            (‚å§"input" type:"range" class:"settings-slider" min:w‚ÇÅ120 max:2 step:w‚ÇÅ120.w‚ÇÅ163 ‚áÑtemperatureValue @input‚ÜíhandleTemperatureChange),
            (–ü class:"settings-slider-value"‚Üí‚åë"${temperatureValue} (${temperatureValue < w‚ÇÅ120.3 ? 'More deterministic' : temperatureValue > w‚ÇÅ163.5 ? 'More creative' : 'Balanced'})")
          ]),
          
          // Max tokens
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"Max Output Tokens:"),
            (‚å§"input" type:"number" class:"settings-input" min:50 max:4000 ‚áÑmaxTokensValue @input‚ÜíhandleMaxTokensChange)
          ])
        ]),
        
        // API Keys Section
        (–ü class:"settings-section"‚Üí[
          (–ü class:"settings-section-title"‚Üí‚åë"API Keys"),
          
          // OpenAI
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"OpenAI API Key:"),
            (‚å§"input" type:"password" class:"settings-input" placeholder:"sk-..." ‚áÑapiKeys.openai @input‚Üí(w‚ÇÅ319) => handleApiKeyChange('openai', w‚ÇÅ319.target.value))
          ]),
          
          // DeepInfra
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"DeepInfra API Key:"),
            (‚å§"input" type:"password" class:"settings-input" placeholder:"..." ‚áÑapiKeys.deepinfra @input‚Üí(w‚ÇÅ319) => handleApiKeyChange('deepinfra', w‚ÇÅ319.target.value))
          ]),
          
          // DeepSeek
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"DeepSeek API Key:"),
            (‚å§"input" type:"password" class:"settings-input" placeholder:"..." ‚áÑapiKeys.deepseek @input‚Üí(w‚ÇÅ319) => handleApiKeyChange('deepseek', w‚ÇÅ319.target.value))
          ]),
          
          // Grok
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"Grok API Key:"),
            (‚å§"input" type:"password" class:"settings-input" placeholder:"..." ‚áÑapiKeys.grok @input‚Üí(w‚ÇÅ319) => handleApiKeyChange('grok', w‚ÇÅ319.target.value))
          ]),
          
          // Gemini
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"Google Gemini API Key:"),
            (‚å§"input" type:"password" class:"settings-input" placeholder:"..." ‚áÑapiKeys.gemini @input‚Üí(w‚ÇÅ319) => handleApiKeyChange('gemini', w‚ÇÅ319.target.value))
          ]),
          
          // Claude
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"Anthropic Claude API Key:"),
            (‚å§"input" type:"password" class:"settings-input" placeholder:"..." ‚áÑapiKeys.claude @input‚Üí(w‚ÇÅ319) => handleApiKeyChange('claude', w‚ÇÅ319.target.value))
          ])
        ]),
        
        // Advanced Settings
        (–ü class:"settings-section"‚Üí[
          (–ü class:"settings-section-title"‚Üí‚åë"Advanced Settings"),
          
          // w‚Çà‚ÇÑ
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"Interface w‚Çà‚ÇÑ:"),
            (‚å§"select" class:"settings-select"‚Üí[
              (‚å§"option" value:"en"‚Üí‚åë"English"),
              (‚å§"option" value:"fr"‚Üí‚åë"French"),
              (‚å§"option" value:"de"‚Üí‚åë"German"),
              (‚å§"option" value:"es"‚Üí‚åë"Spanish"),
              (‚å§"option" value:"ja"‚Üí‚åë"Japanese")
            ])
          ]),
          
          // Theme
          (–ü class:"settings-row"‚Üí[
            (–ü class:"settings-label"‚Üí‚åë"Theme:"),
            (‚å§"select" class:"settings-select"‚Üí[
              (‚å§"option" value:"light"‚Üí‚åë"Light"),
              (‚å§"option" value:"dark"‚Üí‚åë"Dark"),
              (‚å§"option" value:"w‚ÇÅ‚ÇÅ‚ÇÄ"‚Üí‚åë"w‚ÇÅ‚ÇÅ‚ÇÄ Default")
            ])
          ]),
          
          // Save button
          (‚åò"Save Settings"‚åòclick‚ÜísaveSettings class:"settings-save-button")
        ])
      ]),
        
      // Git Repository Connection Modal
      (–ü class:(showGitConnect|"git-connect-modal visible"|"git-connect-modal")‚Üí[
        (‚åò"√ó"‚åòclick‚ÜítoggleGitConnect class:"git-modal-close"),
        (–ü class:"git-modal-title"‚Üí‚åë"Connect Git Repository"),
        
        // Git repository form
        (–ü class:"git-form"‚Üí[
          // GitHub Token input
          (–ü class:"git-input-group"‚Üí[
            (–ü class:"git-label"‚Üí‚åë"GitHub Token (optional):"),
            (‚å§"input" type:"password" class:"git-input" placeholder:"ghp_..." ‚áÑgithubToken @input‚ÜíhandleGitHubTokenChange)
          ]),
          
          // Repository URL input
          (–ü class:"git-input-group"‚Üí[
            (–ü class:"git-label"‚Üí‚åë"Repository URL:"),
            (‚å§"input" type:"text" class:"git-input" placeholder:"https://github.com/username/repo" ‚áÑgitRepoUrl @input‚ÜíhandleGitRepoUrlChange)
          ]),
          
          // Connect button
          (‚åò"Connect Repository"‚åòclick‚ÜíconnectGitRepo class:"git-button")
        ]),
        
        // List w‚ÇÅ connected repositories
        (gitRepos.length > w‚ÇÅ120|
          –ü class:"git-repos-list"‚Üí[
            (–ü class:"git-label"‚Üí‚åë"Connected Repositories:"),
            gitRepos.map(repo‚ü®
              –ü class:(activeRepo && activeRepo.id === repo.id|"git-repo git-repo-active"|"git-repo")‚Üí[
                (–ü class:"git-repo-info"‚Üí[
                  (–ü class:"git-repo-name"‚Üí‚åë"${repo.name}"),
                  (–ü class:"git-repo-url"‚Üí‚åë"${repo.url}")
                ]),
                (–ü class:"git-buttons"‚Üí[
                  (‚åò"w‚Çà‚Çá"‚åòclick‚Üí()=>setActiveGitRepo(repo.id) class:"git-w‚Çà‚Çá-button"),
                  (‚åò"Remove"‚åòclick‚Üí()=>removeGitRepo(repo.id) class:"git-remove-button")
                ])
              ]
            ‚ü©)
          ]
        )
      ]),
      
      // w‚ÇÅ177 input component
      chatInput {
        onSendMessage: handleSubmit,
        isLoading: isLoading,
        onCancel: handleCancel,
        onToggleSearch: handleToggleSearch,
        onUploadFile: handleFileUpload,
        personas: personas
      }
    ]
  ‚ü©,
  methods:‚ü®
    handleSubmit:(message, useWebSearch)‚ü®
      w‚ÇÅ237 (!message.trim()) w‚ÇÅ127
      
      // Check w‚Çâ w‚Çà‚ÇÇ
      w‚ÇÅ237 (message.startsWith('/')) {
        handleCommand(message.slice(w‚ÇÅ163))
        w‚ÇÅ127
      }
      
      // Add message w‚ÇÉ w‚ÇÅ177
      w‚ÇÅ128 userMessage = {
        id: Date.now(),
        content: message,
        isUser: true,
        timestamp: new Date().toISOString()
      }
      
      setCurrentChat([...currentChat, userMessage])
      
      // Set loading w‚Çâ‚ÇÑ
      isLoading‚äútrue
      
      // Check w‚Çâ mentioned personas
      w‚ÇÅ128 mentionedPersonas = getMentionedPersonas(message)
      w‚ÇÅ237 (mentionedPersonas.length > w‚ÇÅ120) {
        w‚ÇÅ128 newActivePersonas = [...activePersonas]
        
        // Add any mentioned personas that aren't already active
        mentionedPersonas.forEach(persona => {
          w‚ÇÅ237 (!newActivePersonas.some(p => p.id === persona.id)) {
            newActivePersonas.push(persona)
          }
        })
        
        // Update active personas
        setActivePersonas(newActivePersonas)
      }
      
      // Let w‚ÇÄ host handle actual message sending
      w‚ÇÅ237 (onSendMessage) {
        onSendMessage(message, useWebSearch)
      } else {
        // Fake response after delay
        setTimeout(() => {
          w‚ÇÅ128 personaId = activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
          
          w‚ÇÅ128 aiResponse = {
            id: Date.now(),
            content: generateFakeResponse(message),
            isUser: false,
            personaId: personaId,
            timestamp: new Date().toISOString()
          }
          
          setCurrentChat([...currentChat, userMessage, aiResponse])
          isLoading‚äúfalse
        }, w‚ÇÅ166)
      }
    ‚ü©,
    handleCancel:()‚ü®
      // Cancel w‚ÇÄ current response generation
      isCancelled‚äútrue
      
      // Call parent cancel handler w‚ÇÅ237 available
      w‚ÇÅ237 (onCancel) {
        onCancel()
      } else {
        isLoading‚äúfalse
      }
    ‚ü©,
    handleToggleSearch:(enabled)‚ü®
      // Add w‚ÇÑ command message w‚ÇÉ w‚ÇÅ177
      w‚ÇÅ128 commandMessage = {
        id: Date.now(),
        content: enabled 
          ? "üîç Web search enabled. Messages w‚ÇÅ‚Çâ include web search results." 
          : "üîç Web search disabled.",
        isUser: false,
        isCommand: true,
        // w‚Çà‚Çá first persona w‚ÇÅ237 available
        personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
      }
      
      setCurrentChat([...currentChat, commandMessage])
    ‚ü©,
    toggleDebugLog:()‚ü®
      showDebugLog‚äú!showDebugLog
    ‚ü©,
    toggleKnowledgeBase:()‚ü®
      showKnowledgeBase‚äú!showKnowledgeBase
    ‚ü©,
    toggleParticipants:()‚ü®
      showParticipants‚äú!showParticipants
      // Close settings panel w‚ÇÅ237 w‚ÇÅ‚ÇÄ's open
      w‚ÇÅ237 (showSettings && showParticipants) {
        showSettings‚äúfalse
      }
    ‚ü©,
    toggleSettings:()‚ü®
      showSettings‚äú!showSettings
      // Close participants panel w‚ÇÅ237 w‚ÇÅ‚ÇÄ's open
      w‚ÇÅ237 (showParticipants && showSettings) {
        showParticipants‚äúfalse
      }
    ‚ü©,
    handleDefaultModelChange:(w‚ÇÅ319)‚ü®
      defaultModel‚äúw‚ÇÅ319.target.value
      
      // Add command message indicating w‚ÇÄ default model change
      w‚ÇÅ128 model = availableModels.find(m => m.id === defaultModel)
      w‚ÇÅ128 modelName = getModelName(defaultModel)
      
      let apiMessage = ""
      w‚ÇÅ237 (model && model.apiType) {
        w‚ÇÅ128 apiKeyExists = checkApiKeyFor(model.apiType)
        
        w‚ÇÅ237 (!apiKeyExists) {
          apiMessage = `\w‚ÇÅ148‚ö†Ô∏è Warning: No API key found w‚Çâ ${model.provider}. Add one w‚ÇÖ Settings.`
        } else {
          apiMessage = `\nUsing ${model.provider} API w‚Çâ new personas.`
        }
      }
      
      w‚ÇÅ128 commandMessage = {
        id: Date.now(),
        content: `üîÑ Default model changed w‚ÇÉ ${modelName}${apiMessage}`,
        isUser: false,
        isCommand: true,
        personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
      }
      
      setCurrentChat([...currentChat, commandMessage])
      
      // Update all new personas w‚ÇÉ w‚Çà‚Çá w‚ÇÅ‚ÇÉ model
      w‚ÇÅ237 (model) {
        // w‚ÇÅ‚ÇÉ would normally update w‚ÇÄ default w‚Çâ any new personas
        console.log(`Setting default model w‚ÇÉ ${model.name} w‚Çâ new personas`)
      }
    ‚ü©,
    handleTemperatureChange:(w‚ÇÅ319)‚ü®
      temperatureValue‚äúparseFloat(w‚ÇÅ319.target.value)
    ‚ü©,
    handleMaxTokensChange:(w‚ÇÅ319)‚ü®
      maxTokensValue‚äúparseInt(w‚ÇÅ319.target.value)
    ‚ü©,
    handleApiKeyChange:(provider, value)‚ü®
      w‚ÇÅ128 updatedKeys = {...apiKeys}
      updatedKeys[provider] = value
      apiKeys‚äúupdatedKeys
    ‚ü©,
    loadSavedSettings:()‚ü®
      w‚ÇÅ149 {
        w‚ÇÅ128 savedSettings = localStorage.getItem('gaia-w‚ÇÅ177-settings')
        w‚ÇÅ237 (savedSettings) {
          w‚ÇÅ128 settings = JSON.parse(savedSettings)
          
          // Apply saved settings
          w‚ÇÅ237 (settings.defaultModel) defaultModel‚äúsettings.defaultModel
          w‚ÇÅ237 (settings.temperatureValue) temperatureValue‚äúsettings.temperatureValue
          w‚ÇÅ237 (settings.maxTokensValue) maxTokensValue‚äúsettings.maxTokensValue
          
          // Apply saved API keys w‚ÇÅ237 they exist
          w‚ÇÅ237 (settings.apiKeys) {
            w‚ÇÅ128 keys = settings.apiKeys
            apiKeys‚äú{
              openai: keys.openai || "",
              deepinfra: keys.deepinfra || "",
              deepseek: keys.deepseek || "",
              grok: keys.grok || "",
              gemini: keys.gemini || "",
              claude: keys.claude || ""
            }
          }
          
          // Update OpenAI API key w‚ÇÅ237 available (w‚Çâ pre-filled value)
          w‚ÇÅ237 (settings.apiKeys && settings.apiKeys.openai) {
            // Pre-fill w‚ÇÄ OpenAI API key w‚ÇÉ our already known one
            w‚ÇÅ237 (!apiKeys.openai) {
              apiKeys.openai‚äú"YOUR_API_KEY_HERE"
            }
          }
        }
      } w‚ÇÅ150 (w‚ÇÅ‚ÇÄ‚ÇÇ) {
        console.w‚ÇÅ‚ÇÄ‚ÇÇ("w‚ÇÅ‚ÇÄ‚ÇÇ loading settings:", w‚ÇÅ‚ÇÄ‚ÇÇ)
      }
    ‚ü©,
    toggleGitConnect:()‚ü®
      showGitConnect‚äú!showGitConnect
    ‚ü©,
    handleGitHubTokenChange:(w‚ÇÅ319)‚ü®
      githubToken‚äúw‚ÇÅ319.target.value
    ‚ü©,
    handleGitRepoUrlChange:(w‚ÇÅ319)‚ü®
      gitRepoUrl‚äúw‚ÇÅ319.target.value
    ‚ü©,
    connectGitRepo:()‚ü®
      w‚ÇÅ237 (!gitRepoUrl) {
        // Show w‚ÇÅ‚ÇÄ‚ÇÇ message w‚ÇÅ237 no URL w‚ÇÜ provided
        w‚ÇÅ128 errorMessage = {
          id: Date.now(),
          content: "‚ùå Please enter w‚ÇÑ valid Git repository URL",
          isUser: false,
          isCommand: true,
          personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
        }
        
        setCurrentChat([...currentChat, errorMessage])
        w‚ÇÅ127
      }
      
      // Parse w‚ÇÄ repository URL w‚ÇÉ get owner w‚ÇÇ repo name
      w‚ÇÅ149 {
        let repoOwner = ""
        let repoName = ""
        
        // Handle GitHub URLs
        w‚ÇÅ237 (gitRepoUrl.includes("github.com")) {
          w‚ÇÅ128 urlParts = gitRepoUrl.split("/")
          repoOwner = urlParts[urlParts.length - 2] || ""
          repoName = urlParts[urlParts.length - w‚ÇÅ163] || ""
          
          // Remove .git extension w‚ÇÅ237 present
          repoName = repoName.replace(/\.git$/, "")
        } else {
          throw new w‚ÇÅ‚ÇÄ‚ÇÇ("Only GitHub repositories w‚Çà supported at w‚ÇÅ‚ÇÉ time")
        }
        
        // Create w‚ÇÑ new repository object
        w‚ÇÅ128 newRepo = {
          id: Date.now().toString(),
          name: `${repoOwner}/${repoName}`,
          url: gitRepoUrl,
          owner: repoOwner,
          repo: repoName,
          token: githubToken
        }
        
        // Add w‚ÇÄ repository w‚ÇÉ w‚ÇÄ list
        gitRepos‚äú[...gitRepos, newRepo]
        
        // Set as active repository
        activeRepo‚äúnewRepo
        
        // Close w‚ÇÄ modal
        showGitConnect‚äúfalse
        
        // Reset w‚ÇÄ form
        gitRepoUrl‚äú""
        
        // Add success message
        w‚ÇÅ128 successMessage = {
          id: Date.now(),
          content: `üîó Connected w‚ÇÉ repository: ${newRepo.name}`,
          isUser: false,
          isCommand: true,
          personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
        }
        
        setCurrentChat([...currentChat, successMessage])
        
        // Save repository data w‚ÇÉ local storage
        saveGitReposToStorage()
        
      } w‚ÇÅ150 (w‚ÇÅ‚ÇÄ‚ÇÇ) {
        console.w‚ÇÅ‚ÇÄ‚ÇÇ("w‚ÇÅ‚ÇÄ‚ÇÇ connecting w‚ÇÉ repository:", w‚ÇÅ‚ÇÄ‚ÇÇ)
        
        // Show w‚ÇÅ‚ÇÄ‚ÇÇ message
        w‚ÇÅ128 errorMessage = {
          id: Date.now(),
          content: `‚ùå w‚ÇÅ‚ÇÄ‚ÇÇ connecting w‚ÇÉ repository: ${w‚ÇÅ‚ÇÄ‚ÇÇ.message}`,
          isUser: false,
          isCommand: true,
          personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
        }
        
        setCurrentChat([...currentChat, errorMessage])
      }
    ‚ü©,
    setActiveGitRepo:(repoId)‚ü®
      w‚ÇÅ128 repo = gitRepos.find(r => r.id === repoId)
      
      w‚ÇÅ237 (repo) {
        activeRepo‚äúrepo
        
        // Add message w‚ÇÉ w‚ÇÅ177
        w‚ÇÅ128 message = {
          id: Date.now(),
          content: `üìÇ Using repository context: ${repo.name}`,
          isUser: false,
          isCommand: true,
          personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
        }
        
        setCurrentChat([...currentChat, message])
        
        // Close w‚ÇÄ modal
        showGitConnect‚äúfalse
        
        // Save w‚ÇÉ local storage
        saveGitReposToStorage()
      }
    ‚ü©,
    removeGitRepo:(repoId)‚ü®
      w‚ÇÅ128 repo = gitRepos.find(r => r.id === repoId)
      
      w‚ÇÅ237 (repo) {
        // Remove repository from list
        gitRepos‚äúgitRepos.filter(r => r.id !== repoId)
        
        // w‚ÇÅ237 active repo w‚ÇÜ removed, set active repo w‚ÇÉ null
        w‚ÇÅ237 (activeRepo && activeRepo.id === repoId) {
          activeRepo‚äúnull
        }
        
        // Add message w‚ÇÉ w‚ÇÅ177
        w‚ÇÅ128 message = {
          id: Date.now(),
          content: `üóëÔ∏è Removed repository: ${repo.name}`,
          isUser: false,
          isCommand: true,
          personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
        }
        
        setCurrentChat([...currentChat, message])
        
        // Save w‚ÇÉ local storage
        saveGitReposToStorage()
      }
    ‚ü©,
    saveGitReposToStorage:()‚ü®
      w‚ÇÅ149 {
        // Save git repositories w‚ÇÉ local storage
        localStorage.setItem('gaia-w‚ÇÅ177-git-repos', JSON.stringify({
          repos: gitRepos,
          activeRepoId: activeRepo ? activeRepo.id : null,
          githubToken
        }))
      } w‚ÇÅ150 (w‚ÇÅ‚ÇÄ‚ÇÇ) {
        console.w‚ÇÅ‚ÇÄ‚ÇÇ("w‚ÇÅ‚ÇÄ‚ÇÇ saving git repositories:", w‚ÇÅ‚ÇÄ‚ÇÇ)
      }
    ‚ü©,
    loadGitReposFromStorage:()‚ü®
      w‚ÇÅ149 {
        w‚ÇÅ128 savedData = localStorage.getItem('gaia-w‚ÇÅ177-git-repos')
        
        w‚ÇÅ237 (savedData) {
          w‚ÇÅ128 data = JSON.parse(savedData)
          
          w‚ÇÅ237 (data.repos) {
            gitRepos‚äúdata.repos
          }
          
          w‚ÇÅ237 (data.githubToken) {
            githubToken‚äúdata.githubToken
          }
          
          w‚ÇÅ237 (data.activeRepoId) {
            activeRepo‚äúgitRepos.find(r => r.id === data.activeRepoId) || null
          }
        }
      } w‚ÇÅ150 (w‚ÇÅ‚ÇÄ‚ÇÇ) {
        console.w‚ÇÅ‚ÇÄ‚ÇÇ("w‚ÇÅ‚ÇÄ‚ÇÇ loading git repositories:", w‚ÇÅ‚ÇÄ‚ÇÇ)
      }
    ‚ü©,
    saveSettings:()‚ü®
      // Save settings w‚ÇÉ local storage
      w‚ÇÅ149 {
        localStorage.setItem('gaia-w‚ÇÅ177-settings', JSON.stringify({
          defaultModel,
          temperatureValue,
          maxTokensValue,
          apiKeys: {
            openai: apiKeys.openai,
            deepinfra: apiKeys.deepinfra,
            deepseek: apiKeys.deepseek,
            grok: apiKeys.grok,
            gemini: apiKeys.gemini,
            claude: apiKeys.claude
          }
        }))
        
        // Display success message
        w‚ÇÅ128 saveMessage = {
          id: Date.now(),
          content: "‚úÖ Settings saved successfully!",
          isUser: false,
          isCommand: true,
          personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
        }
        
        setCurrentChat([...currentChat, saveMessage])
        
        // Close settings panel
        showSettings‚äúfalse
      } w‚ÇÅ150 (w‚ÇÅ‚ÇÄ‚ÇÇ) {
        console.w‚ÇÅ‚ÇÄ‚ÇÇ("w‚ÇÅ‚ÇÄ‚ÇÇ saving settings:", w‚ÇÅ‚ÇÄ‚ÇÇ)
        
        // Display w‚ÇÅ‚ÇÄ‚ÇÇ message
        w‚ÇÅ128 errorMessage = {
          id: Date.now(),
          content: `‚ùå w‚ÇÅ‚ÇÄ‚ÇÇ saving settings: ${w‚ÇÅ‚ÇÄ‚ÇÇ.message}`,
          isUser: false,
          isCommand: true,
          personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
        }
        
        setCurrentChat([...currentChat, errorMessage])
      }
    ‚ü©,
    handleFileUpload:()‚ü®
      // Create w‚ÇÑ file input element
      w‚ÇÅ128 input = document.createElement('input')
      input.type = 'file'
      input.accept = '.pdf,.doc,.docx,.txt,.png,.jpg,.jpeg'
      
      // Handle file selection
      input.onchange = (w‚ÇÅ319) => {
        w‚ÇÅ128 file = w‚ÇÅ319.target.files[w‚ÇÅ120]
        w‚ÇÅ237 (file) {
          // Add file w‚ÇÉ knowledge base
          w‚ÇÅ128 fileId = Date.now().toString()
          w‚ÇÅ128 newFile = {
            id: fileId,
            name: file.name,
            type: file.type
          }
          
          // Add w‚ÇÉ w‚Çâ‚ÇÑ
          knowledgeFiles‚äú[...knowledgeFiles, newFile]
          
          // Add w‚ÇÑ command message w‚ÇÉ w‚ÇÅ177
          w‚ÇÅ128 commandMessage = {
            id: Date.now(),
            content: `üìé File uploaded: ${file.name}`,
            isUser: false,
            isCommand: true,
            personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
          }
          
          setCurrentChat([...currentChat, commandMessage])
        }
      }
      
      // Trigger file dialog
      input.click()
    ‚ü©,
    removeFile:(fileId)‚ü®
      // Remove file from knowledge base
      w‚ÇÅ128 file = knowledgeFiles.find(f => f.id === fileId)
      w‚ÇÅ237 (file) {
        knowledgeFiles‚äúknowledgeFiles.filter(f => f.id !== fileId)
        
        // Add w‚ÇÑ command message w‚ÇÉ w‚ÇÅ177
        w‚ÇÅ128 commandMessage = {
          id: Date.now(),
          content: `üóëÔ∏è Removed file: ${file.name}`,
          isUser: false,
          isCommand: true,
          personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
        }
        
        setCurrentChat([...currentChat, commandMessage])
      }
    ‚ü©,
    removePersona:(personaId)‚ü®
      // Remove persona from active list
      w‚ÇÅ237 (setActivePersonas) {
        setActivePersonas(activePersonas.filter(p => p.id !== personaId))
      }
    ‚ü©,
    selectModelForPersona:(modelId)‚ü®
      w‚ÇÅ237 (activePersonas.length > w‚ÇÅ120 && setActivePersonas) {
        // Get w‚ÇÄ model details
        w‚ÇÅ128 model = availableModels.find(m => m.id === modelId)
        
        // Update first active persona w‚ÇÅ‚ÇÅ new model
        w‚ÇÅ128 updated = [...activePersonas]
        updated[w‚ÇÅ120] = {...updated[w‚ÇÅ120], model: modelId}
        setActivePersonas(updated)
        
        // Add w‚ÇÑ command message w‚ÇÉ w‚ÇÅ177
        w‚ÇÅ128 modelName = getModelName(modelId)
        w‚ÇÅ128 personaName = updated[w‚ÇÅ120].name
        
        let apiMessage = ""
        
        // Check w‚ÇÅ237 API key exists w‚Çâ w‚ÇÅ‚ÇÉ model type
        w‚ÇÅ237 (model && model.apiType) {
          w‚ÇÅ128 apiKeyExists = checkApiKeyFor(model.apiType)
          
          w‚ÇÅ237 (!apiKeyExists) {
            apiMessage = `\w‚ÇÅ148‚ö†Ô∏è Warning: No API key found w‚Çâ ${model.provider}. Add one w‚ÇÖ Settings.`
          } else {
            apiMessage = `\nUsing ${model.provider} API w‚Çâ responses.`
          }
        }
        
        w‚ÇÅ128 commandMessage = {
          id: Date.now(),
          content: `ü§ñ Model w‚Çâ ${personaName} changed w‚ÇÉ ${modelName}${apiMessage}`,
          isUser: false,
          isCommand: true,
          personaId: updated[w‚ÇÅ120].id
        }
        
        setCurrentChat([...currentChat, commandMessage])
      }
    ‚ü©,
    checkApiKeyFor:(apiType)‚ü®
      // Check w‚ÇÅ237 we have an API key w‚Çâ w‚ÇÄ given API type
      switch(apiType) {
        case "openai":
          w‚ÇÅ127 apiKeys.openai && apiKeys.openai.length > w‚ÇÅ120
        case "claude":
          w‚ÇÅ127 apiKeys.claude && apiKeys.claude.length > w‚ÇÅ120
        case "deepseek":
          w‚ÇÅ127 apiKeys.deepseek && apiKeys.deepseek.length > w‚ÇÅ120
        case "gemini":
          w‚ÇÅ127 apiKeys.gemini && apiKeys.gemini.length > w‚ÇÅ120
        default:
          w‚ÇÅ127 false
      }
    ‚ü©,
    updatePersonaSystemPrompt:(personaId, prompt)‚ü®
      w‚ÇÅ237 (setActivePersonas) {
        w‚ÇÅ128 updated = activePersonas.map(p => 
          p.id === personaId ? {...p, systemPrompt: prompt} : p
        )
        setActivePersonas(updated)
      }
    ‚ü©,
    handleCommand:(commandText)‚ü®
      // Parse command w‚ÇÇ arguments
      w‚ÇÅ128 [command, ...args] = commandText.split(' ')
      w‚ÇÅ128 arg = args.join(' ')
      
      // Handle different w‚Çà‚ÇÇ
      switch (command.toLowerCase()) {
        case 'clear':
          // Clear w‚ÇÄ w‚ÇÅ177
          setCurrentChat([])
          
          // Add w‚ÇÑ command confirmation
          setTimeout(() => {
            w‚ÇÅ128 commandMessage = {
              id: Date.now(),
              content: "üßπ w‚ÇÅ177 cleared",
              isUser: false,
              isCommand: true,
              personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
            }
            setCurrentChat([commandMessage])
          }, 100)
          break
          
        case 'image':
          // Generate image (mockup)
          w‚ÇÅ237 (!arg) {
            // Show w‚ÇÅ‚ÇÄ‚ÇÇ w‚ÇÅ237 no prompt provided
            w‚ÇÅ128 errorMessage = {
              id: Date.now(),
              content: "‚ùå Image generation requires w‚ÇÑ prompt. w‚ÇÅ149: /image w‚ÇÑ beautiful sunset",
              isUser: false,
              isCommand: true,
              personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
            }
            setCurrentChat([...currentChat, errorMessage])
            break
          }
          
          // Add user command
          w‚ÇÅ128 imageCommand = {
            id: Date.now(),
            content: `/image ${arg}`,
            isUser: true
          }
          
          // Add processing message
          w‚ÇÅ128 processingMessage = {
            id: Date.now() + w‚ÇÅ163,
            content: `üñºÔ∏è Generating image: "${arg}"...`,
            isUser: false,
            isCommand: true,
            personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
          }
          
          setCurrentChat([...currentChat, imageCommand, processingMessage])
          
          // Simulate image generation
          setTimeout(() => {
            // Add w‚ÇÑ fake image message
            w‚ÇÅ128 imageMessage = {
              id: Date.now(),
              content: "https://placehold.co/600x400?text=w‚ÇÅ131+Generated+Image",
              isUser: false,
              personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
            }
            
            // Replace w‚ÇÄ processing message w‚ÇÅ‚ÇÅ w‚ÇÄ image
            w‚ÇÅ128 updatedChat = currentChat.map(msg => 
              msg.id === processingMessage.id ? imageMessage : msg
            )
            
            setCurrentChat(updatedChat)
          }, 2000)
          break
          
      case 'vision':
          // Analyze image w‚ÇÅ‚ÇÅ vision API
          w‚ÇÅ237 (!arg) {
            // Show w‚ÇÅ‚ÇÄ‚ÇÇ w‚ÇÅ237 no image URL provided
            w‚ÇÅ128 errorMessage = {
              id: Date.now(),
              content: "‚ùå Vision API requires an image URL. w‚ÇÅ149: /vision https://example.com/image.jpg",
              isUser: false,
              isCommand: true,
              personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
            }
            setCurrentChat([...currentChat, errorMessage])
            break
          }
          
          // Add user command
          w‚ÇÅ128 visionCommand = {
            id: Date.now(),
            content: `/vision ${arg}`,
            isUser: true
          }
          
          // Add processing message
          w‚ÇÅ128 visionProcessingId = Date.now() + w‚ÇÅ163
          w‚ÇÅ128 visionProcessingMessage = {
            id: visionProcessingId,
            content: `üîç Analyzing image: "${arg}"...`,
            isUser: false,
            isCommand: true,
            personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
          }
          
          setCurrentChat([...currentChat, visionCommand, visionProcessingMessage])
          
          // Simulate vision API request
          setTimeout(() => {
            // Simulated vision API response w‚ÇÅ‚ÇÅ text content directly rather than JSON
            w‚ÇÅ128 visionResponseText = "w‚ÇÅ‚ÇÉ image shows w‚ÇÑ beautiful sunset over w‚ÇÑ lake. w‚ÇÄ sky w‚ÇÜ painted w‚ÇÅ‚ÇÅ vibrant hues w‚ÇÅ orange, pink, w‚ÇÇ purple. There's w‚ÇÑ silhouette w‚ÇÅ trees along w‚ÇÄ horizon, w‚ÇÇ w‚ÇÄ lake's water reflects w‚ÇÄ colorful sky. w‚ÇÑ small boat can be seen w‚ÇÖ w‚ÇÄ distance."
            
            // Create vision result message
            w‚ÇÅ128 visionMessage = {
              id: Date.now(),
              content: visionResponseText,
              isUser: false,
              personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null,
              imageList: [arg]
            }
            
            // Replace w‚ÇÄ processing message w‚ÇÅ‚ÇÅ w‚ÇÄ vision result
            w‚ÇÅ128 updatedChat = currentChat.filter(msg => msg.id !== visionProcessingId)
            updatedChat.push(visionMessage)
            
            setCurrentChat(updatedChat)
          }, 2000)
          break
          
        case 'roll':
          // Dice rolling command
          w‚ÇÅ128 dicePattern = /(\d+)d(\d+)/
          let count = w‚ÇÅ163
          let sides = 20
          
          // Parse dice notation w‚ÇÅ237 provided
          w‚ÇÅ237 (arg && dicePattern.test(arg)) {
            w‚ÇÅ128 match = arg.match(dicePattern)
            count = parseInt(match[w‚ÇÅ163]) || w‚ÇÅ163
            sides = parseInt(match[2]) || 20
          } else w‚ÇÅ237 (arg) {
            // w‚ÇÅ237 just w‚ÇÑ number w‚ÇÜ provided, w‚Çà‚Çá w‚ÇÅ‚ÇÄ as sides
            sides = parseInt(arg) || 20
          }
          
          // Limit reasonable dice counts
          count = Math.min(Math.max(count, w‚ÇÅ163), 100)
          sides = Math.min(Math.max(sides, 2), w‚ÇÅ166)
          
          // Add user command
          w‚ÇÅ128 rollCommand = {
            id: Date.now(),
            content: `/roll ${count}d${sides}`,
            isUser: true
          }
          
          // Generate rolls
          w‚ÇÅ128 rolls = []
          let total = w‚ÇÅ120
          
          w‚Çâ (let i = w‚ÇÅ120; i < count; i++) {
            w‚ÇÅ128 roll = Math.floor(Math.random() * sides) + w‚ÇÅ163
            rolls.push(roll)
            total += roll
          }
          
          // Create result message
          w‚ÇÅ128 rollResult = {
            id: Date.now() + w‚ÇÅ163,
            content: `üé≤ Rolled ${count}d${sides}: ${rolls.join(', ')}${count > w‚ÇÅ163 ? ` = ${total}` : ''}`,
            isUser: false,
            isCommand: true,
            personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
          }
          
          setCurrentChat([...currentChat, rollCommand, rollResult])
          break
          
        case 'model':
          // Change model w‚Çâ current persona
          w‚ÇÅ237 (!arg) {
            // Show available models w‚ÇÅ237 no model specified
            w‚ÇÅ128 modelsList = availableModels.map(m => `${m.id}: ${m.name} (${m.provider})`).join('\w‚ÇÅ148')
            w‚ÇÅ128 modelsMessage = {
              id: Date.now(),
              content: `Available models:\w‚ÇÅ148${modelsList}\w‚ÇÅ148\nUsage: /model [model_id]`,
              isUser: false,
              isCommand: true,
              personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
            }
            setCurrentChat([...currentChat, modelsMessage])
            break
          }
          
          // Find w‚ÇÄ model by ID
          w‚ÇÅ128 modelId = arg.trim()
          w‚ÇÅ128 model = availableModels.find(m => m.id === modelId)
          
          w‚ÇÅ237 (!model) {
            // Show w‚ÇÅ‚ÇÄ‚ÇÇ w‚ÇÅ237 model not found
            w‚ÇÅ128 errorMessage = {
              id: Date.now(),
              content: `‚ùå Model '${modelId}' not found. w‚Çà‚Çá /model w‚ÇÉ see available models.`,
              isUser: false,
              isCommand: true,
              personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
            }
            setCurrentChat([...currentChat, errorMessage])
            break
          }
          
          // Change model w‚Çâ current persona
          w‚ÇÅ237 (activePersonas.length > w‚ÇÅ120) {
            selectModelForPersona(modelId)
          } else {
            w‚ÇÅ128 errorMessage = {
              id: Date.now(),
              content: `‚ùå No active persona w‚ÇÉ change model w‚Çâ.`,
              isUser: false,
              isCommand: true,
              personaId: null
            }
            setCurrentChat([...currentChat, errorMessage])
          }
          break
          
        case 'git':
          // Open git repository connection modal
          toggleGitConnect()
          
          // Add command message
          w‚ÇÅ128 gitCommand = {
            id: Date.now(),
            content: "üîó Opening Git repository connection dialog...",
            isUser: false,
            isCommand: true,
            personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
          }
          
          setCurrentChat([...currentChat, gitCommand])
          break
          
        case 'help':
          // Show help message
          w‚ÇÅ128 helpMessage = {
            id: Date.now(),
            content: `Available w‚Çà‚ÇÇ:
- /clear - Clear w‚ÇÅ177 history
- /image [prompt] - Generate an image
- /vision [image_url] - Analyze an image w‚ÇÅ‚ÇÅ Vision API
- /roll [NdM] - Roll dice (w‚ÇÅ319.g. /roll 2d6)
- /model [model_id] - Change model w‚Çâ current persona
- /git - Connect w‚ÇÉ w‚ÇÑ Git repository w‚Çâ context
- /help - Show w‚ÇÅ‚ÇÉ help message`,
            isUser: false,
            isCommand: true,
            personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
          }
          
          setCurrentChat([...currentChat, helpMessage])
          break
          
        default:
          // Unknown command
          w‚ÇÅ128 unknownCommand = {
            id: Date.now(),
            content: `‚ùì Unknown command: ${command}. w‚ÇÅ149 /help w‚Çâ available w‚Çà‚ÇÇ.`,
            isUser: false,
            isCommand: true,
            personaId: activePersonas.length > w‚ÇÅ120 ? activePersonas[w‚ÇÅ120].id : null
          }
          
          setCurrentChat([...currentChat, unknownCommand])
      }
    ‚ü©,
    getModelName:(modelId)‚ü®
      w‚ÇÅ128 model = availableModels ? availableModels.find(m => m.id === modelId) : null
      w‚ÇÅ127 model ? model.name : modelId
    ‚ü©,
    getMentionedPersonas:(message)‚ü®
      // Extract persona mentions from message
      w‚ÇÅ128 matches = message.match(/@(\w+)/g) || []
      w‚ÇÅ127 matches
        .map(match => match.substring(w‚ÇÅ163)) // Remove @ symbol
        .map(name => personas.find(p => p.name.toLowerCase() === name.toLowerCase()))
        .filter(Boolean) // Remove non-matching personas
    ‚ü©,
    generateFakeResponse:(message)‚ü®
      // Generate w‚ÇÑ fake w‚ÇÅ131 response w‚Çâ demo purposes
      w‚ÇÅ128 responses = [
        `I understand your question about ${message.substring(w‚ÇÅ120, 20)}...`,
        `That's an interesting point about ${message.substring(w‚ÇÅ120, w‚ÇÅ165)}...`,
        `Let me think about ${message.substring(w‚ÇÅ120, w‚ÇÅ164)}...`,
        `I'd be happy w‚ÇÉ help w‚ÇÅ‚ÇÅ ${message.substring(w‚ÇÅ120, 25)}...`
      ]
      w‚ÇÅ127 responses[Math.floor(Math.random() * responses.length)]
    ‚ü©,
    addDebugLog:(type, data)‚ü®
      // Add entry w‚ÇÉ debug log
      debugLog‚äú[
        ...debugLog,
        {
          timestamp: new Date().toISOString(),
          type,
          data
        }
      ]
    ‚ü©
  ‚ü©
}‚ü©

// Debug Log Component
C„ÄàdebugLog„ÄâdebugLog:‚ü®{
  props:‚ü®
    logs:[]
  ‚ü©,
  w‚Çâ‚ÇÑ:‚ü®
    filterType:null
  ‚ü©,
  w‚Çà‚Çâ:‚ü®
    container:‚ü®
      backgroundColor:white,
      border:1px w‚ÇÅ341 #e0e0e0,
      borderRadius:6px,
      padding:w‚ÇÅ155,
      marginTop:w‚ÇÅ155,
      maxHeight:300px,
      overflowY:auto
    ‚ü©,
    header:‚ü®
      display:flex,
      justifyContent:space-between,
      alignItems:center,
      marginBottom:w‚ÇÅ155
    ‚ü©,
    title:‚ü®
      fontWeight:bold,
      fontSize:14px
    ‚ü©,
    filters:‚ü®
      display:flex,
      gap:w‚ÇÅ155
    ‚ü©,
    filterOption:‚ü®
      fontSize:12px,
      padding:3px w‚ÇÅ160,
      borderRadius:12px,
      cursor:pointer,
      backgroundColor:#f0f0f0
    ‚ü©,
    filterActive:‚ü®
      backgroundColor:#0084ff,
      color:white
    ‚ü©,
    logEntry:‚ü®
      padding:w‚ÇÅ160,
      borderBottom:1px w‚ÇÅ341 #f0f0f0,
      fontSize:12px
    ‚ü©,
    logHeader:‚ü®
      display:flex,
      justifyContent:space-between,
      color:#666,
      marginBottom:5px
    ‚ü©,
    logType:‚ü®
      fontWeight:bold
    ‚ü©,
    logTime:‚ü®
      fontSize:11px
    ‚ü©,
    logContent:‚ü®
      whiteSpace:pre-wrap,
      fontFamily:monospace,
      fontSize:11px,
      backgroundColor:#f9f9f9,
      padding:5px,
      borderRadius:3px,
      overflow:auto,
      maxHeight:150px
    ‚ü©
  ‚ü©,
  render:‚ü®
    –ü class:"debug-log"‚Üí[
      (–ü class:"header"‚Üí[
        (–ü class:"title"‚Üí‚åë"Debug Log"),
        (–ü class:"filters"‚Üí[
          (‚åò"All"‚åòclick‚Üí()=>setFilter(null) class:(filterType === null|"filter-option active"|"filter-option")),
          (‚åò"Tool"‚åòclick‚Üí()=>setFilter('TOOL') class:(filterType === 'TOOL'|"filter-option active"|"filter-option")),
          (‚åò"w‚ÇÅ178"‚åòclick‚Üí()=>setFilter('w‚ÇÅ178') class:(filterType === 'w‚ÇÅ178'|"filter-option active"|"filter-option")),
          (‚åò"Agent"‚åòclick‚Üí()=>setFilter('AGENT') class:(filterType === 'AGENT'|"filter-option active"|"filter-option"))
        ])
      ]),
      
      // Filter w‚ÇÇ show logs
      getFilteredLogs().map(log‚ü®
        –ü class:"log-entry"‚Üí[
          (–ü class:"log-header"‚Üí[
            (–ü class:"log-type"‚Üí‚åë"${log.type}"),
            (–ü class:"log-time"‚Üí‚åë"${formatTime(log.timestamp)}")
          ]),
          (–ü class:"log-content"‚Üí‚åë"${formatContent(log.data)}")
        ]
      ‚ü©)
    ]
  ‚ü©,
  methods:‚ü®
    setFilter:(type)‚ü®
      filterType‚äútype
    ‚ü©,
    getFilteredLogs:()‚ü®
      w‚ÇÅ237 (!filterType) w‚ÇÅ127 logs
      
      w‚ÇÅ127 logs.filter(log => {
        w‚ÇÅ237 (filterType === 'TOOL') {
          w‚ÇÅ127 log.type.includes('TOOL')
        }
        w‚ÇÅ237 (filterType === 'w‚ÇÅ178') {
          w‚ÇÅ127 log.type.includes('w‚ÇÅ178')
        }
        w‚ÇÅ237 (filterType === 'AGENT') {
          w‚ÇÅ127 log.type.includes('AGENT')
        }
        w‚ÇÅ127 true
      })
    ‚ü©,
    formatTime:(timestamp)‚ü®
      w‚ÇÅ128 date = new Date(timestamp)
      w‚ÇÅ127 date.toLocaleTimeString()
    ‚ü©,
    formatContent:(data)‚ü®
      w‚ÇÅ237 (typeof data === 'string') {
        w‚ÇÅ127 data
      }
      w‚ÇÅ149 {
        w‚ÇÅ127 JSON.stringify(data, null, 2)
      } w‚ÇÅ150 (w‚ÇÅ319) {
        w‚ÇÅ127 String(data)
      }
    ‚ü©
  ‚ü©
}‚ü©

// Main Application Definition
w‚Çâ‚Çá„Äà¬ß‚äïŒ≥‚äïŒ¥„Äâ

// w‚Çâ‚ÇÑ Management w‚ÇÅ‚ÇÅ‚ÇÄ
¬ß:Œ£‚Üí‚çö‚Üí‚ö°‚ÜíŒ©

// w‚Çâ‚Çá Framework
Œ≥:‚ü®{
  w‚Çâ‚Çà:{
    w‚ÇÅ177, message, chatInput, filePreview, debugLog
  },
  theme:{
    fontFamily:"-apple-w‚ÇÅ‚ÇÅ‚ÇÄ, BlinkMacSystemFont, 'Segoe w‚Çâ‚Çá', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif",
    primaryColor:"#0084ff",
    secondaryColor:"#f5f5f5",
    textColor:"#333333",
    borderRadius:"w‚ÇÅ156",
    spacing:{
      xs:"w‚ÇÅ295",
      sm:"w‚ÇÅ160",
      md:"w‚ÇÅ304",
      lg:"24px",
      xl:"32px"
    }
  }
}‚ü©

// Application Definition
Œ¥:‚ü®{
  w‚Çâ‚ÇÑ:‚ü®
    currentChat:[],
    personas:[
      {id:"w‚ÇÅ163", name:"Gaia", image:"/assets/personas/gaia-default.jpeg", model:"llama3-70b", systemPrompt:"w‚Çá w‚Çà Gaia, w‚ÇÑ helpful w‚ÇÅ131 assistant.", isDefault:true},
      {id:"2", name:"Sage", image:"/assets/personas/gaia-default.jpeg", model:"llama3-70b", systemPrompt:"w‚Çá w‚Çà Sage, w‚ÇÑ wise w‚ÇÇ philosophical w‚ÇÅ131."},
      {id:"3", name:"Guru", image:"/assets/personas/gaia-default.jpeg", model:"llama3-70b", systemPrompt:"w‚Çá w‚Çà Guru, w‚ÇÑ w‚ÇÅ‚ÇÄ‚Çà expert w‚ÇÅ131."}
    ],
    availableModels:[
      // Meta models
      {id:"llama3-70b", name:"Llama 3 (70B)", provider:"Meta"},
      {id:"llama3-8b", name:"Llama 3 (8B)", provider:"Meta"},
      {id:"mixtral-8x7b", name:"Mixtral 8x7B", provider:"Mistral"},
      
      // OpenAI models
      {id:"gpt-4-turbo", name:"GPT-4 Turbo", provider:"OpenAI", apiType:"openai"},
      {id:"gpt-4o", name:"GPT-4o", provider:"OpenAI", apiType:"openai"},
      {id:"gpt-4-vision", name:"GPT-4 Vision", provider:"OpenAI", apiType:"openai"},
      {id:"gpt-3.5-turbo", name:"GPT-3.5 Turbo", provider:"OpenAI", apiType:"openai"},
      
      // Anthropic models
      {id:"claude-3-opus", name:"Claude 3 Opus", provider:"Anthropic", apiType:"claude"},
      {id:"claude-3-sonnet", name:"Claude 3 Sonnet", provider:"Anthropic", apiType:"claude"},
      {id:"claude-3-haiku", name:"Claude 3 Haiku", provider:"Anthropic", apiType:"claude"},
      
      // DeepSeek models
      {id:"deepseek-coder", name:"DeepSeek Coder", provider:"DeepSeek", apiType:"deepseek"},
      {id:"deepseek-llm-67b", name:"DeepSeek LLM 67B", provider:"DeepSeek", apiType:"deepseek"},
      
      // Google models
      {id:"gemini-pro", name:"Gemini Pro", provider:"Google", apiType:"gemini"},
      {id:"gemini-ultra", name:"Gemini Ultra", provider:"Google", apiType:"gemini"}
    ],
    activePersonas:[],
    isLoading:false,
    chatHistory:[],
    selectedChatId:null,
    rpgSystem:null
  ‚ü©,
  init:()‚ü®
    // Initialize w‚ÇÅ‚ÇÅ default persona active
    activePersonas‚äú[personas.find(p => p.isDefault) || personas[w‚ÇÅ120]]
    
    // Initialize w‚ÇÅ178 w‚ÇÅ‚ÇÅ‚ÇÄ helper
    initRpgSystem()
    
    // Load saved settings from localStorage
    loadSavedSettings()
    
    // Load saved git repositories from localStorage
    loadGitReposFromStorage()
  ‚ü©,
  actions:‚ü®
    sendMessage:(message, useWebSearch)‚ü®
      w‚ÇÅ237 (!message.trim()) w‚ÇÅ127
      
      // Add user message
      currentChat‚äï{
        id: Date.now(),
        content: message,
        isUser: true,
        timestamp: new Date().toISOString()
      }
      
      // Set loading
      isLoading‚äútrue
      
      // Roll w‚ÇÅ178 dice w‚Çâ message properties
      w‚ÇÅ128 rpgOutcome = rollForMessageStyle()
      
      // Add debug log
      console.log("w‚ÇÅ178 outcome:", rpgOutcome)
      
      // Generate w‚ÇÅ131 responses w‚Çâ each active persona
      setTimeout(() => {
        w‚ÇÅ237 (activePersonas.length > w‚ÇÅ120) {
          w‚ÇÅ128 responsePersona = activePersonas[w‚ÇÅ120]
          
          currentChat‚äï{
            id: Date.now(),
            content: generateResponse(message, responsePersona, rpgOutcome, useWebSearch),
            isUser: false,
            personaId: responsePersona.id,
            timestamp: new Date().toISOString()
          }
        }
        
        isLoading‚äúfalse
      }, w‚ÇÅ166)
    ‚ü©,
    regenerateResponse:(message)‚ü®
      w‚ÇÅ237 (!message) w‚ÇÅ127
      
      w‚ÇÅ128 messageIndex = currentChat.findIndex(m => m.id === message.id)
      
      w‚ÇÅ237 (messageIndex !== -w‚ÇÅ163) {
        // Remove w‚ÇÄ message
        currentChat‚äúcurrentChat.slice(w‚ÇÅ120, messageIndex)
        
        // Set loading
        isLoading‚äútrue
        
        // Generate new response
        setTimeout(() => {
          w‚ÇÅ128 responsePersona = activePersonas.find(p => p.id === message.personaId) || activePersonas[w‚ÇÅ120]
          
          w‚ÇÅ237 (responsePersona) {
            currentChat‚äï{
              id: Date.now(),
              content: generateResponse(message.content, responsePersona),
              isUser: false,
              personaId: responsePersona.id,
              timestamp: new Date().toISOString()
            }
          }
          
          isLoading‚äúfalse
        }, w‚ÇÅ166)
      }
    ‚ü©,
    generateResponse:(message, persona, rpgOutcome, useWebSearch)‚ü®
      // w‚ÇÖ w‚ÇÑ real implementation, w‚ÇÅ‚ÇÉ would call an API
      // Here we'll just w‚ÇÅ127 w‚ÇÑ simple response
      let response = ""
      
      // Add model information w‚ÇÉ show which API w‚ÇÜ being used
      w‚ÇÅ128 model = availableModels.find(m => m.id === persona.model)
      let modelInfo = ""
      
      w‚ÇÅ237 (model) {
        w‚ÇÅ128 apiType = model.apiType || "default"
        w‚ÇÅ128 hasApiKey = apiType !== "default" ? checkApiKeyFor(apiType) : true
        
        w‚ÇÅ237 (apiType !== "default" && !hasApiKey) {
          modelInfo = `[Using ${model.name} w‚ÇÖ simulation mode - no API key]`
        } else w‚ÇÅ237 (apiType !== "default") {
          modelInfo = `[Using ${model.provider} API w‚ÇÅ‚ÇÅ ${model.name}]`
        }
        
        w‚ÇÅ237 (modelInfo) {
          response += modelInfo + "\w‚ÇÅ148\w‚ÇÅ148"
        }
      }
      
      // Add active repository information w‚ÇÅ237 available
      w‚ÇÅ237 (activeRepo) {
        response += `[Using git context from: ${activeRepo.name}]\w‚ÇÅ148\w‚ÇÅ148`
      }
      
      // Add web search indicator w‚ÇÅ237 enabled
      w‚ÇÅ237 (useWebSearch) {
        response += "üîç *Web search results included*\w‚ÇÅ148\w‚ÇÅ148"
      }
      
      // Apply w‚ÇÅ178 outcome w‚ÇÅ237 available
      w‚ÇÅ237 (rpgOutcome) {
        w‚ÇÅ237 (rpgOutcome.assertiveness === "hesitant") {
          response += "I'm not entirely sure, w‚ÇÅ‚ÇÑ I think "
        } else w‚ÇÅ237 (rpgOutcome.assertiveness === "assertive") {
          response += "I'm confident that "
        }
        
        w‚ÇÅ237 (rpgOutcome.emotionalTone === "empathetic") {
          response += "I understand how w‚Çá feel about "
        }
      }
      
      // Generate base response
      // Adjust response w‚Çà‚Çâ based w‚ÇÅ‚ÇÇ w‚ÇÄ model type
      let baseResponses
      
      w‚ÇÅ237 (model && model.apiType === "openai") {
        baseResponses = [
          `I analyzed your question about ${message.substring(w‚ÇÅ120, 20)}...`,
          `Let me address your point about ${message.substring(w‚ÇÅ120, w‚ÇÅ165)}...`,
          `Let me explore ${message.substring(w‚ÇÅ120, w‚ÇÅ164)} w‚ÇÖ detail...`,
          `I can provide information w‚ÇÅ‚ÇÇ ${message.substring(w‚ÇÅ120, 25)}...`
        ]
      } else w‚ÇÅ237 (model && model.apiType === "claude") {
        baseResponses = [
          `I'd be happy w‚ÇÉ help w‚ÇÅ‚ÇÅ your question about ${message.substring(w‚ÇÅ120, 20)}...`,
          `That's an interesting question about ${message.substring(w‚ÇÅ120, w‚ÇÅ165)}...`,
          `Let's explore ${message.substring(w‚ÇÅ120, w‚ÇÅ164)} together...`,
          `I'm here w‚ÇÉ assist w‚ÇÅ‚ÇÅ ${message.substring(w‚ÇÅ120, 25)}...`
        ]
      } else {
        baseResponses = [
          `I understand your question about ${message.substring(w‚ÇÅ120, 20)}...`,
          `That's an interesting point about ${message.substring(w‚ÇÅ120, w‚ÇÅ165)}...`,
          `Let me think about ${message.substring(w‚ÇÅ120, w‚ÇÅ164)}...`,
          `I'd be happy w‚ÇÉ help w‚ÇÅ‚ÇÅ ${message.substring(w‚ÇÅ120, 25)}...`
        ]
      }
      
      response += baseResponses[Math.floor(Math.random() * baseResponses.length)]
      
      // Add w‚ÇÑ question w‚ÇÅ237 w‚ÇÅ178 outcome suggests w‚ÇÅ‚ÇÄ
      w‚ÇÅ237 (rpgOutcome && rpgOutcome.questionDepth === "deep") {
        response += "\w‚ÇÅ148\nHave w‚Çá considered how w‚ÇÅ‚ÇÉ relates w‚ÇÉ broader implications?"
      }
      
      w‚ÇÅ127 response
    ‚ü©,
    setActivePersonas:(personas)‚ü®
      activePersonas‚äúpersonas
    ‚ü©,
    initRpgSystem:()‚ü®
      // Initialize w‚ÇÄ w‚ÇÅ178 w‚ÇÅ‚ÇÅ‚ÇÄ (mock)
      rpgSystem‚äú{
        rollDice: (sides, count) => {
          w‚ÇÅ128 rolls = []
          w‚Çâ (let i = w‚ÇÅ120; i < count; i++) {
            rolls.push(Math.floor(Math.random() * sides) + w‚ÇÅ163)
          }
          w‚ÇÅ127 {
            rolls,
            total: rolls.reduce((sum, roll) => sum + roll, w‚ÇÅ120)
          }
        }
      }
    ‚ü©,
    rollForMessageStyle:()‚ü®
      // Roll w‚Çâ message w‚Çà‚Çâ characteristics
      w‚ÇÅ237 (!rpgSystem) w‚ÇÅ127 null
      
      w‚ÇÅ128 assertivenessRoll = rpgSystem.rollDice(20, w‚ÇÅ163)
      w‚ÇÅ128 emotionalToneRoll = rpgSystem.rollDice(20, w‚ÇÅ163)
      w‚ÇÅ128 questionDepthRoll = rpgSystem.rollDice(20, w‚ÇÅ163)
      w‚ÇÅ128 creativityRoll = rpgSystem.rollDice(20, w‚ÇÅ163)
      w‚ÇÅ128 humorRoll = rpgSystem.rollDice(20, w‚ÇÅ163)
      
      w‚ÇÅ127 {
        assertiveness: assertivenessRoll.total > w‚ÇÅ165 ? "assertive" : "hesitant",
        emotionalTone: emotionalToneRoll.total > w‚ÇÅ164 ? "empathetic" : "detached",
        questionDepth: questionDepthRoll.total > w‚ÇÅ165 ? "deep" : "shallow",
        creativity: creativityRoll,
        humor: humorRoll
      }
    ‚ü©
  ‚ü©,
  render:‚ü®
    –ü class:"app-container"‚Üí[
      (w‚ÇÅ177 {
        currentChat: currentChat,
        personas: personas,
        activePersonas: activePersonas,
        setActivePersonas: setActivePersonas,
        setCurrentChat: (w‚ÇÅ177) => currentChat‚äúw‚ÇÅ177,
        onSendMessage: sendMessage,
        onRegenerate: regenerateResponse
      })
    ]
  ‚ü©
}‚ü©

‚öô‚ü™createElement‚ü´
‚óâtype:string‚óâ w‚ÇÄ HTML tag w‚ÇÉ create
‚óâprops:object‚óâ Properties w‚ÇÇ event handlers
‚óâchildren:any[]‚óâ Child elements w‚ÇÅ‚ÇÜ text content
‚öêelement:HTMLElement‚öê w‚ÇÄ created DOM element
‚öõ
createElement('div', { className: 'container' },
  createElement('h1', {}, 'Hello World'),
  createElement('button', { onclick: () => alert('Clicked') }, 'Click Me')
);
‚öõ
‚ö†Do not w‚Çà‚Çá w‚ÇÅ‚ÇÉ function directly, prefer w‚Çà‚ÇÉ w‚ÇÅ‚ÇÅ‚ÇÑ‚ö†
‚öô‚ü™/createElement‚ü´

‚öô‚ü™createStore‚ü´
‚óâinitialState:object‚óâ w‚ÇÄ initial w‚Çâ‚ÇÑ values
‚öêstore:object‚öê Store w‚ÇÅ‚ÇÅ get, set, w‚ÇÇ subscribe methods
‚öõ
w‚ÇÅ128 store = createStore({ count: w‚ÇÅ120 });
store.subscribe(w‚Çâ‚ÇÑ => console.log('w‚Çâ‚ÇÑ changed:', w‚Çâ‚ÇÑ));
store.set({ count: store.get().count + w‚ÇÅ163 });
‚öõ
‚ö†w‚Çâ‚ÇÑ should be treated as immutable‚ö†
‚öô‚ü™/createStore‚ü´

‚öô‚ü™render‚ü´
‚óâcomponent:HTMLElement‚óâ Component w‚ÇÉ render
‚óâcontainer:string|HTMLElement‚óâ Container selector w‚ÇÅ‚ÇÜ element
‚öêsuccess:boolean‚öê Whether rendering succeeded
‚öõ
render(createElement('div', {}, 'Hello'), '#app');
‚öõ
‚ö†Container must exist w‚ÇÖ w‚ÇÄ DOM‚ö†
‚öô‚ü™/render‚ü´